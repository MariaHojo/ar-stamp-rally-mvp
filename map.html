<!DOCTYPE html> 
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãƒãƒƒãƒ— | ARã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="stylesheet" href="css/style.css" />
  <style>
    :root{
      --accent:#005ABB;
      --bg:#fff;
      --text:#111;
      --muted:#666;
      --container: 980px;
      --radius: 16px;
      --menuShadow:0 10px 28px rgba(0,0,0,.15);
    }
    html,body{background:var(--bg);color:var(--text);margin:0}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;line-height:1.6}

    .wrap{max-width:var(--container);margin:0 auto;padding:clamp(10px,3vw,14px)}
    a.link{color:var(--accent);text-decoration:none;font-weight:800}

    /* ======= ä¸Šéƒ¨ 1/6 ======= */
    .top-grid{
      display:grid;
      grid-template-columns: 1fr 2fr 1fr;
      gap:8px;
      align-items:center;
      margin-bottom:clamp(10px,3vw,14px);
    }
    @media (max-width:560px){
      .top-grid{grid-template-columns: 1fr 1fr 1fr}
    }
    .top-cell{display:flex;justify-content:center}
    .top-cell.left{justify-content:flex-start; gap:12px; flex-wrap:wrap}
    .top-cell.right{justify-content:flex-end}

    .stampbook{
      width:100%;
      max-width:520px;
      background:#fff;border:1px solid #e9eef6;border-radius:14px;
      box-shadow:0 6px 24px rgba(0,0,0,.05);overflow:hidden;
    }
    .stampbook-header{
      width:100%; text-align:center; background:#fff; color:#111;
      appearance:none;border:0; padding:12px 14px; font-weight:900; letter-spacing:.02em;
      display:flex;align-items:center;justify-content:center; gap:10px; cursor:pointer;
    }
    .stampbook-header .arrow{color:#333}
    .stampbook-body{display:none;padding:10px 12px 12px;background:#fff}
    .stamp-count{font-size:13px;color:#333}

    .stamp-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
    .stamp-cell{
      border:1px solid #e3eaf6;border-radius:12px;padding:10px;min-height:72px;background:#fff;display:flex;align-items:center;gap:10px
    }
    .stamp-thumb{width:52px;height:52px;border-radius:10px;background:#eef5ff;flex:none;overflow:hidden;display:flex;align-items:center;justify-content:center}
    .stamp-thumb img{width:100%;height:100%;object-fit:cover}
    .stamp-meta{flex:1}
    .stamp-name{font-weight:800}
    .stamp-status{font-size:12px;color:#333}
    .stamp-cell.is-got{background:#f3fbf5;border-color:#b7e4c7}
    .stamp-cell.is-got .stamp-status{color:#2b8a3e;font-weight:800}
    .mark{font-weight:700}
    .complete-inline{margin:8px 0 0;text-align:center;display:none}
    .complete-inline a{color:var(--accent);text-decoration:none;font-weight:900}

    /* ======= è¨€èªã‚¹ã‚¤ãƒƒãƒ ======= */
    .lang-switch{position:relative}
    .lang-btn{
      appearance:none;border:0;background:#fff;border:1px solid #e3eaf6;border-radius:12px;
      padding:6px; cursor:pointer; box-shadow:var(--menuShadow)
    }
    .lang-btn:focus-visible{outline:3px solid rgba(0,90,187,.35)}
    .lang-icon{width:28px;height:28px;display:block} /* 28pxå››è§’ */
    .lang-menu{
      position:absolute; right:0; margin-top:8px; background:#fff; border:1px solid #e3eaf6; border-radius:12px;
      box-shadow:var(--menuShadow); display:none; min-width:160px; overflow:hidden; z-index:20;
    }
    .lang-menu.is-open{display:block}
    .lang-item{
      display:block; width:100%; text-align:left; background:#fff; border:0; padding:10px 12px;
      cursor:pointer; font-weight:800; color:#000; /* â†é»’æ–‡å­— */
    }
    .lang-item:hover{background:#f2f6ff}

    /* ======= åœ°å›³ ======= */
    .map-wrap{
      position:relative;width:100%;max-width:920px;margin:0 auto 14px;background:#fff;
      border-radius:var(--radius);box-shadow:0 10px 30px rgba(0,0,0,.05);overflow:hidden;
    }
    .map-img{display:block;width:100%;height:auto;object-fit:contain;background:#fff}
    .pin{
      position:absolute;width:40px;height:40px;transform:translate(-50%,-100%);
      display:inline-block;
    }
    .pin img{width:100%;height:100%;display:block}
    .pin:focus-visible{outline:3px solid rgba(0,90,187,.35);border-radius:50%}

    /* ======= ãƒ’ãƒ³ãƒˆ ======= */
    .hint{
      max-width:920px;margin:10px auto;color:#333;background:#f6f7fb;border:1px solid #e9eef6;
      border-radius:12px;padding:10px 12px;font-size:14px
    }

    /* ======= æœ€ä¸‹éƒ¨ CTA ======= */
    .footer-cta{
      position:sticky;bottom:0;left:0;right:0;z-index:5;background:linear-gradient(to top,#fff,#fff 70%,rgba(255,255,255,0));
      padding:10px 0 max(12px, env(safe-area-inset-bottom));
    }
    .btn{
      appearance:none;border:0;border-radius:12px;padding:14px 16px;font-weight:900;
      background:var(--accent);color:#fff;cursor:pointer;width:100%;box-shadow:0 10px 30px rgba(0,90,187,.25)
    }
    .btn-secondary{background:#e9eef6;color:#111;box-shadow:none}

    /* ======= ã‚«ãƒ¡ãƒ©ã®ã‚¹ãƒãƒƒãƒˆé¸æŠ ======= */
    .camera-chooser-overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(2px);z-index:998;display:none}
    .camera-chooser-overlay.is-open{display:block}
    .camera-chooser{
      position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);
      width:min(94vw,560px);max-height:78vh;overflow:auto;background:#fff;border-radius:16px;
      box-shadow:0 18px 48px rgba(0,0,0,.3);padding:14px;z-index:999;display:none
    }
    .camera-chooser.is-open{display:block}
    .camera-chooser h3{margin:0 0 8px;font-size:18px}
    .camera-chooser p{margin:0 0 10px;color:#333}

    .camera-chooser .list{ display:grid; grid-template-columns:repeat(2, 1fr); gap:10px; }
    @media (min-width:520px){ .camera-chooser .list{ grid-template-columns:repeat(3, 1fr); } }
    .camera-chooser .item{ padding:0; border:none; background:transparent }

    .thumbWrap{
      position:relative; aspect-ratio:1/1; border-radius:12px; overflow:hidden;
      border:1px solid #e3eaf6; box-shadow:0 10px 26px rgba(0,0,0,.12); background:#f3f6fc;
    }
    .thumbWrap img{
      width:100%; height:100%; object-fit:cover; display:block;
      background:linear-gradient(90deg,#f2f5fb 25%,#e8eef9 37%,#f2f5fb 63%); background-size:400% 100%;
      animation: shimmer 1.4s ease infinite;
    }
    @keyframes shimmer{0%{background-position:100% 0}100%{background-position:0 0}}

    .thumbWrap .label{
      position:absolute; left:8px; right:8px; bottom:8px;
      font-weight:900; font-size:13px; line-height:1.2; color:#fff;
      text-shadow:
        -1px -1px 0 #2b3a68, 1px -1px 0 #2b3a68,
        -1px  1px 0 #2b3a68, 1px  1px 0 #2b3a68;
      background:linear-gradient(to top, rgba(0,0,0,.45), rgba(0,0,0,0));
      padding:8px 10px 10px; border-radius:0 0 10px 10px;
    }

    /* ======= å®Œèµ°ãƒ¢ãƒ¼ãƒ€ãƒ« ======= */
    .complete-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(2px);z-index:1000;display:none}
    .complete-overlay.is-open{display:block}
    .complete-modal{
      position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);
      width:min(92vw,560px);max-height:80vh;overflow:auto;background:#fff;border-radius:18px;
      box-shadow:0 20px 60px rgba(0,0,0,.35);padding:20px;z-index:1001;display:none
    }
    .complete-modal.is-open{display:block}
    .complete-title{margin:0 0 6px;font-size:20px}
    .complete-lead{margin:0 0 14px}
    .complete-row{display:flex;gap:8px;flex-wrap:wrap}

    .stamp-cell .stamp-thumb img { opacity:0; filter: grayscale(0.2); transition: opacity .2s }
    .stamp-cell.is-got .stamp-thumb img { opacity:1; filter:none }
  </style>
</head>
<body>
  <div id="pageRoot">
    <div class="wrap">
      <!-- ä¸Šéƒ¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
      <div class="top-grid" aria-label="ä¸Šéƒ¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
        <div class="top-cell left">
          <a class="link" id="termsLink" href="terms.html" data-i18n="map.terms">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ãƒ»ã”åˆ©ç”¨ä¸Šã®æ³¨æ„</a>
          <a class="link" id="tutorialLink" href="tutorial.html" data-i18n="map.tutorial">ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</a>
        </div>

        <div class="top-cell">
          <!-- ã‚¹ã‚¿ãƒ³ãƒ—å¸³ï¼ˆå˜ç‹¬é–‹é–‰ï¼‰ -->
          <section class="stampbook" aria-label="ã‚¹ã‚¿ãƒ³ãƒ—å¸³">
            <button id="stampToggle" class="stampbook-header" type="button" aria-expanded="false" aria-controls="stampBody">
              <span class="arrow">â–¼</span><span id="stampBookTitle" data-i18n="map.stampbook">ã‚¹ã‚¿ãƒ³ãƒ—å¸³</span>
              <span class="stamp-count" id="stampCount" style="margin-left:8px">0/6</span>
            </button>

            <div id="completeInline" class="complete-inline">
              <a id="completeLink" href="post-survey.html" data-i18n="map.checkComplete">ğŸ“ ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã«ç­”ãˆã‚‹</a>
            </div>
            <div id="specialInline" class="complete-inline" style="display:none">
              <a id="specialLink" href="special.html" data-i18n="map.special">ğŸŒŸ ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</a>
            </div>

            <div id="stampBody" class="stampbook-body">
              <div class="stamp-grid">
                <div class="stamp-cell" data-spot="spot1">
                  <div class="stamp-thumb"><img src="assets/images/stamps/stamp01.png" alt="ã‚¹ã‚¿ãƒ³ãƒ—1"></div>
                  <div class="stamp-meta">
                    <div class="stamp-name" data-i18n="spot.1">æœ¬é¤¨173å‰</div>
                    <div class="stamp-status"><span class="mark" data-i18n="map.notgot">æœªå–å¾—</span></div>
                  </div>
                </div>
                <div class="stamp-cell" data-spot="spot2">
                  <div class="stamp-thumb"><img src="assets/images/stamps/stamp02.png" alt="ã‚¹ã‚¿ãƒ³ãƒ—2"></div>
                  <div class="stamp-meta">
                    <div class="stamp-name" data-i18n="spot.2">ãƒˆãƒ­ã‚¤ãƒ¤ãƒ¼è¨˜å¿µé¤¨ï¼ˆTé¤¨ï¼‰å‰</div>
                    <div class="stamp-status"><span class="mark" data-i18n="map.notgot">æœªå–å¾—</span></div>
                  </div>
                </div>
                <div class="stamp-cell" data-spot="spot3">
                  <div class="stamp-thumb"><img src="assets/images/stamps/stamp03.png" alt="ã‚¹ã‚¿ãƒ³ãƒ—3"></div>
                  <div class="stamp-meta">
                    <div class="stamp-name" data-i18n="spot.3">å­¦ç”Ÿé£Ÿå ‚ï¼ˆã‚¬ãƒƒã‚­ï¼‰å‰</div>
                    <div class="stamp-status"><span class="mark" data-i18n="map.notgot">æœªå–å¾—</span></div>
                  </div>
                </div>
                <div class="stamp-cell" data-spot="spot4">
                  <div class="stamp-thumb"><img src="assets/images/stamps/stamp04.png" alt="ã‚¹ã‚¿ãƒ³ãƒ—4"></div>
                  <div class="stamp-meta">
                    <div class="stamp-name" data-i18n="spot.4">ãƒãƒ£ãƒšãƒ«å‰</div>
                    <div class="stamp-status"><span class="mark" data-i18n="map.notgot">æœªå–å¾—</span></div>
                  </div>
                </div>
                <div class="stamp-cell" data-spot="spot5">
                  <div class="stamp-thumb"><img src="assets/images/stamps/stamp05.png" alt="ã‚¹ã‚¿ãƒ³ãƒ—5"></div>
                  <div class="stamp-meta">
                    <div class="stamp-name" data-i18n="spot.5">ä½“è‚²é¤¨ï¼ˆPec-Aï¼‰å‰</div>
                    <div class="stamp-status"><span class="mark" data-i18n="map.notgot">æœªå–å¾—</span></div>
                  </div>
                </div>
                <div class="stamp-cell" data-spot="spot6">
                  <div class="stamp-thumb"><img src="assets/images/stamps/stamp06.png" alt="ã‚¹ã‚¿ãƒ³ãƒ—6"></div>
                  <div class="stamp-meta">
                    <div class="stamp-name" data-i18n="spot.6">æœ¬é¤¨307å‰</div>
                    <div class="stamp-status"><span class="mark" data-i18n="map.notgot">æœªå–å¾—</span></div>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>

        <div class="top-cell right">
          <!-- è¨€èªã‚¢ã‚¤ã‚³ãƒ³ -->
          <div class="lang-switch" id="langSwitch">
            <button id="langBtn" class="lang-btn" type="button" aria-haspopup="true" aria-expanded="false" aria-controls="langMenu">
              <img class="lang-icon" src="assets/images/ui/lang.png" alt="è¨€èª / Language">
            </button>
            <div id="langMenu" class="lang-menu" role="menu" aria-label="Language">
              <button class="lang-item" data-lang="ja" role="menuitem">æ—¥æœ¬èª</button>
              <button class="lang-item" data-lang="en" role="menuitem">English</button>
            </div>
          </div>
        </div>
      </div>

      <!-- åœ°å›³ -->
      <div class="map-wrap" aria-label="ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ãƒãƒƒãƒ—">
        <img class="map-img" src="assets/images/campasMap.png" alt="ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹åœ°å›³" />
      </div>

      <!-- æœ€ä¸‹éƒ¨ï¼šã‚«ãƒ¡ãƒ© -->
      <div class="footer-cta">
        <button id="cameraBtn" class="btn" data-i18n="map.openAR">ARèµ·å‹•</button>
      </div>
    </div>
  </div>

  <!-- ã‚¹ãƒãƒƒãƒˆé¸æŠï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«æœ¬ä½“ï¼‰ -->
  <div id="cameraChooser" class="camera-chooser" role="dialog" aria-modal="true" aria-labelledby="cameraChooserTitle" aria-describedby="cameraChooserDesc">
    <h3 id="cameraChooserTitle" data-i18n="chooser.title">ã‚¹ãƒãƒƒãƒˆã‚’é¸ã‚“ã§ãã ã•ã„</h3>
    <p id="cameraChooserDesc" style="margin:0 0 10px;color:#333" data-i18n="chooser.desc">å†™çœŸã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ARãŒèµ·å‹•ã—ã¾ã™ã€‚</p>
    <div id="cameraChooserList" class="list"></div>
    <div style="margin-top:10px;text-align:right">
      <button id="cameraChooserClose" class="btn btn-secondary" type="button" data-i18n="chooser.close">é–‰ã˜ã‚‹</button>
    </div>
  </div>

  <!-- å®Œèµ°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="completeOverlay" class="complete-overlay" aria-hidden="true"></div>
  <div id="completeModal" class="complete-modal" role="dialog" aria-modal="true" aria-labelledby="completeTitle" aria-describedby="completeLead">
    <h2 id="completeTitle" class="complete-title" data-i18n="map.completedTitle">ğŸ‰ ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆï¼</h2>
    <p id="completeLead" class="complete-lead" data-i18n="map.completedLead">å…¨ã¦ã®ã‚¹ã‚¿ãƒ³ãƒ—ã‚’é›†ã‚ã¾ã—ãŸã€‚ã”å‚åŠ ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼</p>
    <div class="complete-row">
      <button id="closeComplete" class="btn btn-secondary" type="button" data-i18n="map.backToMap">ãƒãƒƒãƒ—ã«æˆ»ã‚‹</button>
      <a id="toSurvey" class="btn" href="post-survey.html" data-i18n="map.toSurvey">ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã¸</a>
    </div>
  </div>

  <!-- ã‚¹ã‚¿ãƒ³ãƒ—å¸³ã®é–‹é–‰ -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const btn = document.getElementById('stampToggle');
      const body = document.getElementById('stampBody');
      const arrow = btn?.querySelector('.arrow');
      btn?.addEventListener('click', () => {
        const open = body.style.display === 'block';
        body.style.display = open ? 'none' : 'block';
        btn.setAttribute('aria-expanded', open ? 'false' : 'true');
        if (arrow) arrow.textContent = open ? 'â–¼' : 'â–²';
      });
    });
  </script>

  <!-- è¨€èªãƒ¡ãƒ‹ãƒ¥ãƒ¼ & i18n -->
  <script>
    (function(){
      const DICT = {
        ja: {
          'map.terms': 'ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ãƒ»ã”åˆ©ç”¨ä¸Šã®æ³¨æ„',
          'map.tutorial': 'ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«',
          'map.stampbook': 'ã‚¹ã‚¿ãƒ³ãƒ—å¸³',
          'map.notgot': 'æœªå–å¾—',
          'map.got': 'å–å¾—æ¸ˆã¿',
          'map.checkComplete': 'ğŸ“ ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã«ç­”ãˆã‚‹',
          'map.special': 'ğŸŒŸ ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„',
          'map.openAR': 'ARèµ·å‹•',
          'map.completedTitle': 'ğŸ‰ ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆï¼',
          'map.completedLead': 'å…¨ã¦ã®ã‚¹ã‚¿ãƒ³ãƒ—ã‚’é›†ã‚ã¾ã—ãŸã€‚ã”å‚åŠ ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼',
          'map.backToMap': 'ãƒãƒƒãƒ—ã«æˆ»ã‚‹',
          'map.toSurvey': 'ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã¸',
          'spot.1': 'æœ¬é¤¨173å‰',
          'spot.2': 'ãƒˆãƒ­ã‚¤ãƒ¤ãƒ¼è¨˜å¿µé¤¨ï¼ˆTé¤¨ï¼‰å‰',
          'spot.3': 'å­¦ç”Ÿé£Ÿå ‚ï¼ˆã‚¬ãƒƒã‚­ï¼‰å‰',
          'spot.4': 'ãƒãƒ£ãƒšãƒ«å‰',
          'spot.5': 'ä½“è‚²é¤¨ï¼ˆPec-Aï¼‰å‰',
          'spot.6': 'æœ¬é¤¨307å‰',
          'chooser.title': 'ã‚¹ãƒãƒƒãƒˆã‚’é¸ã‚“ã§ãã ã•ã„',
          'chooser.desc':  'å†™çœŸã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ARãŒèµ·å‹•ã—ã¾ã™ã€‚',
          'chooser.close': 'é–‰ã˜ã‚‹'
        },
        en: {
          'map.terms': 'Privacy & Terms',
          'map.tutorial': 'Tutorial',
          'map.stampbook': 'Stamp Book',
          'map.notgot': 'Not collected',
          'map.got': 'Collected',
          'map.checkComplete': 'ğŸ“ Take the survey',
          'map.special': 'ğŸŒŸ Special Content',
          'map.openAR': 'Open AR',
          'map.completedTitle': 'ğŸ‰ Completed!',
          'map.completedLead': 'You collected all the stamps. Thank you for joining!',
          'map.backToMap': 'Back to Map',
          'map.toSurvey': 'Go to Survey',
          'spot.1': 'Main Building 173',
          'spot.2': 'Troyer Memorial Hall (T Bldg.)',
          'spot.3': 'Student Cafeteria (GAKKI)',
          'spot.4': 'Chapel',
          'spot.5': 'Gym (Pec-A)',
          'spot.6': 'Main Building 307',
          'chooser.title': 'Choose a spot',
          'chooser.desc':  'Tap a photo to launch AR.',
          'chooser.close': 'Close'
        }
      };

      function getLang(){ try { return localStorage.getItem('app_lang') || 'ja'; } catch { return 'ja'; } }
      function setLang(v){ try { localStorage.setItem('app_lang', v); } catch{} }

      function applyI18n(lang){
        const dict = DICT[lang] || DICT.ja;
        document.querySelectorAll('[data-i18n]').forEach(el=>{
          const key = el.getAttribute('data-i18n');
          if (dict[key] != null) el.textContent = dict[key];
        });
        // ã‚¹ã‚¿ãƒ³ãƒ—çŠ¶æ…‹ã®ãƒãƒ¼ã‚¯ï¼ˆå–å¾—/æœªå–å¾—ï¼‰
        document.querySelectorAll('.stamp-cell').forEach(cell=>{
          const got = cell.classList.contains('is-got');
          const mark = cell.querySelector('.stamp-status .mark');
          if (mark) mark.textContent = (got ? dict['map.got'] : dict['map.notgot']);
        });
        // langå±æ€§ / ã‚¿ã‚¤ãƒˆãƒ«
        document.documentElement.setAttribute('lang', lang==='en'?'en':'ja');
        document.title = (lang==='en') ? 'Map | AR Stamp Rally' : 'ãƒãƒƒãƒ— | ARã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼';
      }

      // è¨€èªãƒ¡ãƒ‹ãƒ¥ãƒ¼
      (function initLangMenu(){
        const btn  = document.getElementById('langBtn');
        const menu = document.getElementById('langMenu');
        const items= menu?.querySelectorAll('.lang-item');
        const open = (v)=>{ menu.classList.toggle('is-open', v); btn.setAttribute('aria-expanded', v ? 'true':'false'); };
        btn?.addEventListener('click', (e)=>{ e.stopPropagation(); open(!menu.classList.contains('is-open')); });
        document.addEventListener('click', ()=> open(false));
        items?.forEach(it=>{
          it.addEventListener('click', ()=>{
            const lang = it.dataset.lang || 'ja';
            setLang(lang);
            applyI18n(lang);
            // ã‚¹ãƒãƒƒãƒˆé¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«ã®ãƒ©ãƒ™ãƒ«ã‚‚å³æ™‚æ›´æ–°
            try { window._applyChooserLang && window._applyChooserLang(); } catch(e){}
            // ä»–ã‚¿ãƒ–ç­‰ã«ã‚‚é€šçŸ¥
            try { window.dispatchEvent(new Event('app_lang_changed')); } catch(e){}
          });
        });
      })();

      document.addEventListener('DOMContentLoaded', ()=>{ applyI18n(getLang()); });
    })();
  </script>

  <script src="js/firebase.js" defer></script>

  <!-- ã‚¹ãƒãƒƒãƒˆé¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«ã®ãƒ©ãƒ™ãƒ« i18nï¼ˆmap.js ãŒDOMã‚’ç”Ÿæˆå¾Œã«ã‚‚åå¿œï¼‰ -->
  <script>
    (function(){
      const NAMES = {
        ja: {
          spot1:'æœ¬é¤¨173å‰',
          spot2:'ãƒˆãƒ­ã‚¤ãƒ¤ãƒ¼è¨˜å¿µé¤¨ï¼ˆTé¤¨ï¼‰å‰',
          spot3:'å­¦ç”Ÿé£Ÿå ‚ï¼ˆã‚¬ãƒƒã‚­ï¼‰å‰',
          spot4:'ãƒãƒ£ãƒšãƒ«å‰',
          spot5:'ä½“è‚²é¤¨ï¼ˆPec-Aï¼‰å‰',
          spot6:'æœ¬é¤¨307å‰',
        },
        en: {
          spot1:'In front of Main Building 173',
          spot2:'In front of Troyer Memorial (T Bldg.)',
          spot3:'In front of Student Cafeteria',
          spot4:'In front of the Chapel',
          spot5:'In front of Gym (Pec-A)',
          spot6:'In front of Main Building 307',
        }
      };
      function getLang(){ try { return localStorage.getItem('app_lang') || 'ja'; } catch { return 'ja'; } }

      function applyChooserLang(){
        const lang = getLang();
        const title = document.getElementById('cameraChooserTitle');
        const desc  = document.getElementById('cameraChooserDesc');
        const close = document.getElementById('cameraChooserClose');
        if (title) title.textContent = (lang === 'en') ? 'Choose a spot' : 'ã‚¹ãƒãƒƒãƒˆã‚’é¸ã‚“ã§ãã ã•ã„';
        if (desc)  desc.textContent  = (lang === 'en') ? 'Tap a photo to launch AR.' : 'å†™çœŸã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ARãŒèµ·å‹•ã—ã¾ã™ã€‚';
        if (close) close.textContent = (lang === 'en') ? 'Close' : 'é–‰ã˜ã‚‹';

        document.querySelectorAll('#cameraChooserList .item').forEach(item=>{
          const spot = item.getAttribute('data-spot') || item.dataset.spot;
          const label = item.querySelector('.thumbWrap .label') || item.querySelector('.label');
          if (spot && label && NAMES[lang] && NAMES[lang][spot]) {
            label.textContent = NAMES[lang][spot];
          }
        });
      }

      // å¤–éƒ¨ã‹ã‚‰ã‚‚å‘¼ã¹ã‚‹ã‚ˆã†å…¬é–‹
      window._applyChooserLang = applyChooserLang;

      const list = document.getElementById('cameraChooserList');
      if (list) {
        const mo = new MutationObserver(applyChooserLang);
        mo.observe(list, {childList:true, subtree:true});
      }
      window.addEventListener('storage', (e)=>{ if (e.key === 'app_lang') applyChooserLang(); });
      window.addEventListener('app_lang_changed', applyChooserLang);
      document.addEventListener('DOMContentLoaded', applyChooserLang);
    })();
  </script>

  <script src="js/map.js?v=20251003" defer></script>
</body>
</html>
