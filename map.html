<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>マップ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="stylesheet" href="css/style.css" />
  <style>
    /* ---- 既存のレイアウト（簡略。必要に応じて既存CSSが優先されます） ---- */
    .container{max-width:900px;margin:0 auto;padding:12px}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .btn{appearance:none;border:0;border-radius:12px;padding:12px 16px;font-weight:800;background:#005ABB;color:#fff;cursor:pointer}
    .btn-secondary{background:#e9eef6;color:#111}
    .legend{margin:8px 0;padding:8px 12px;font-size:14px;background:#f6f7fb;border-radius:10px;color:#333}

    /* ---- スポット選択の吹き出し（既存） ---- */
    .camera-chooser-overlay{
      position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(2px);
      z-index:998;display:block;
    }
    .camera-chooser{
      position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);
      width:min(92vw,560px);max-height:75vh;overflow:auto;background:#fff;border-radius:16px;
      box-shadow:0 18px 48px rgba(0,0,0,.3);padding:16px;z-index:999;
    }
    .camera-chooser[hidden], .camera-chooser-overlay[hidden]{display:none}
    .camera-chooser h3{margin:0 0 10px;font-size:18px}
    .camera-chooser .list{display:grid;grid-template-columns:1fr;gap:8px}
    .camera-chooser .item{display:flex;gap:10px;align-items:center;border:1px solid #e3eaf6;border-radius:12px;padding:10px}
    .camera-chooser .thumb{width:56px;height:56px;border-radius:10px;background:#eef5ff;flex:none;overflow:hidden}
    .camera-chooser .thumb img{width:100%;height:100%;object-fit:cover}
    .camera-chooser .meta{flex:1}
    .camera-chooser .meta .name{font-weight:800}
    .camera-chooser .meta .type{font-size:12px;color:#333}
    .camera-chooser .go{white-space:nowrap}

    /* ---- ★ コンプリート・モーダル（今回追加） ---- */
    .complete-overlay{
      position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(2px);
      z-index:1000;display:none;
    }
    .complete-overlay.is-open{display:block}
    .complete-modal{
      position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);
      width:min(92vw,560px);max-height:80vh;overflow:auto;background:#fff;border-radius:18px;
      box-shadow:0 20px 60px rgba(0,0,0,.35);padding:20px;z-index:1001;
      display:none;
    }
    .complete-modal.is-open{display:block}
    .complete-title{margin:0 0 6px;font-size:20px}
    .complete-lead{margin:0 0 14px}
    .complete-row{display:flex;gap:8px;flex-wrap:wrap}
    .complete-row .btn{flex:1;min-width:160px}
    .dim-when-modal{transition:opacity .2s ease}
    .dim-when-modal.is-dim{opacity:.15;pointer-events:none}

    /* iOSセーフエリア */
    .safe-pad-bottom{padding-bottom:max(18px,env(safe-area-inset-bottom))}
  </style>
</head>
<body>
  <div id="pageRoot" class="dim-when-modal">
    <div class="container">
      <header class="row">
        <button id="cameraBtn" class="btn">カメラ起動</button>
        <a class="btn btn-secondary" href="tutorial.html">チュートリアル</a>
      </header>

      <div class="legend">マップからスポットを選び、ARでスタンプを集めましょう（全3箇所：ARスポット）</div>

      <!-- ここにマップ本体やピン、スタンプ帳など既存のDOMがある想定 -->
      <div id="mapArea"><!-- 既存のマップUIをそのまま残してください --></div>
      <div id="stampBook"><!-- 既存のスタンプ帳UIをそのまま残してください --></div>

      <!-- 完了リンク（任意、常時リンク） -->
      <div id="completeLinkArea" style="margin-top:10px;">
        <a href="complete.html">🎉 コンプリートを確認する</a>
      </div>
    </div>
  </div>

  <!-- 既存：スポット選択の吹き出し -->
  <div id="cameraChooserOverlay" class="camera-chooser-overlay" hidden></div>
  <div id="cameraChooser" class="camera-chooser" hidden role="dialog" aria-modal="true" aria-labelledby="cameraChooserTitle">
    <h3 id="cameraChooserTitle">スポットを選んでください</h3>
    <div id="cameraChooserList" class="list"></div>
    <div class="row safe-pad-bottom"><button id="cameraChooserClose" class="btn btn-secondary" type="button">キャンセル</button></div>
  </div>

  <!-- ★ 追加：コンプリート・モーダル（complete.html 相当の内容） -->
  <div id="completeOverlay" class="complete-overlay" aria-hidden="true"></div>
  <div id="completeModal" class="complete-modal" role="dialog" aria-modal="true" aria-labelledby="completeTitle" aria-describedby="completeLead">
    <h2 id="completeTitle" class="complete-title">🎉 コンプリート！</h2>
    <p id="completeLead" class="complete-lead">全てのスタンプを集めました。ご参加ありがとうございます！</p>
    <div class="complete-row safe-pad-bottom">
      <button id="closeComplete" class="btn btn-secondary" type="button">マップに戻る</button>
      <a id="toSurvey" class="btn" href="post-survey.html">アンケートへ（お答えいただいた方にはスペシャルコンテンツがあります！）</a>
    </div>
  </div>

  <!-- スクリプト -->
  <script src="js/firebase.js" defer></script>
  <script src="js/map.js?v=20250926c" defer></script>
</body>
</html>
