<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãƒãƒƒãƒ— | ARã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <link rel="stylesheet" href="css/style.css">
  <style>
    /* ---- ä¸Šéƒ¨ãƒãƒ¼ã®3åˆ†å‰²ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ ---- */
    #menuBar {
      position: sticky; /* ä¸Šéƒ¨å›ºå®š */
      top: 0;
      z-index: 1000;
      background: #f9f9f9;
      border-bottom: 1px solid #ddd;
      padding: 8px 12px;
    }
    .menubar-inner {
      display: grid;
      grid-template-columns: 1fr auto 1fr; /* å·¦ï¼šãƒªãƒ³ã‚¯ç¾¤ / ä¸­å¤®ï¼šã‚¹ã‚¿ãƒ³ãƒ—å¸³ / å³ï¼šè¨€èª */
      align-items: center;
      gap: 8px;
      max-width: 980px;
      margin: 0 auto;
    }
    .mb-left, .mb-center, .mb-right { display: flex; align-items: center; }
    .mb-left { gap: 10px; justify-content: flex-start; }
    .mb-center { justify-content: center; position: relative; } /* â† ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®åŸºæº– */
    .mb-right { justify-content: flex-end; gap: 8px; }

    .mb-link, .mb-btn {
      color: #005ABB;
      font-weight: 600;
      text-decoration: none;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 14px;
      padding: 6px 8px;
      border-radius: 8px;
    }
    .mb-link:hover, .mb-btn:hover { background: #eef4ff; }

    /* ---- ã‚¹ã‚¿ãƒ³ãƒ—å¸³ï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³åŒ–ï¼‰ ---- */
    #stampToggleBtn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #005ABB;
      color: #fff;
      border: 0;
      border-radius: 10px;
      padding: 8px 12px;
      font-weight: 800;
      box-shadow: 0 6px 16px rgba(0,90,187,.2);
    }
    #stampBook {
      position: absolute;           /* â† ä»–è¦ç´ ã‚’æŠ¼ã—ä¸‹ã’ãªã„ */
      top: calc(100% + 8px);        /* ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ã®ä¸‹ã«è¡¨ç¤º */
      left: 50%;
      transform: translateX(-50%);
      width: min(92vw, 520px);
      max-height: 60vh;
      overflow: auto;
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 16px;
      box-shadow: 0 18px 40px rgba(0,0,0,.18);
      padding: 12px;
      display: none;                /* æ—¢å®šã¯é–‰ã˜ã‚‹ */
      z-index: 1200;
    }
    #stampBook.open { display: block; }
    .stamp-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 8px;
    }
    .stamp-cell {
      width: 60px; height: 60px;
      border: 1px dashed #cbd5e1;
      border-radius: 10px;
      display: grid; place-items: center;
      background: #fafafa;
    }
    .stamp-cell img { width: 100%; height: 100%; object-fit: contain; }

    /* ---- è¨€èªã‚¢ã‚¤ã‚³ãƒ³ ---- */
    #langBtn {
      width: 28px; height: 28px; display: inline-block;
    }
    #langBtn img { width: 28px; height: 28px; display: block; }

    /* ---- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é ˜åŸŸ ---- */
    .page-container { max-width: 980px; margin: 10px auto; padding: 0 12px; }

    /* å®Œèµ°ãƒªãƒ³ã‚¯è¡Œï¼ˆæ–‡è¨€æ›´æ–°å¯¾å¿œï¼‰ */
    .complete-row {
      display: none; /* map.js å´ã§é”æˆæ™‚ã«è¡¨ç¤ºåˆ‡æ›¿ã™ã‚‹æƒ³å®š */
      background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 10px 12px;
      margin: 10px 0; display: flex; align-items: center; justify-content: space-between; gap: 10px;
    }
    .complete-row a {
      text-decoration: none; font-weight: 800; color: #005ABB;
      background: #eef4ff; padding: 8px 12px; border-radius: 10px;
    }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆå†™çœŸã‚°ãƒªãƒƒãƒ‰ç­‰ï¼‰ã¯æ—¢å­˜ã® style.css ã‚’ä½¿ç”¨ */
    @media (max-width: 480px){
      .stamp-grid { grid-template-columns: repeat(6, 44px); }
      .stamp-cell { width: 44px; height: 44px; }
    }
  </style>
</head>
<body>
  <!-- ä¸Šéƒ¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ -->
  <div id="menuBar" role="navigation" aria-label="ç”»é¢ä¸Šéƒ¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
    <div class="menubar-inner">
      <!-- å·¦ï¼šå„ç¨®ãƒªãƒ³ã‚¯ -->
      <div class="mb-left">
        <a class="mb-link" href="terms.html">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ãƒ»ã”åˆ©ç”¨ä¸Šã®æ³¨æ„</a>
        <a class="mb-link" href="tutorial.html">ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</a>
      </div>

      <!-- ä¸­å¤®ï¼šã‚¹ã‚¿ãƒ³ãƒ—å¸³ï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ï¼‰ -->
      <div class="mb-center">
        <button id="stampToggleBtn" class="mb-btn" type="button">ã‚¹ã‚¿ãƒ³ãƒ—å¸³</button>
        <div id="stampBook" class="stamp-book" aria-label="ã‚¹ã‚¿ãƒ³ãƒ—å¸³">
          <div class="stamp-grid" id="stampGrid">
            <!-- map.js ã§ã‚¹ã‚¿ãƒ³ãƒ—çŠ¶æ…‹ã«å¿œã˜ã¦å·®ã—æ›¿ãˆï¼ã“ã“ã¯ãƒ—ãƒ¬ãƒ¼ã‚¹ -->
            <div class="stamp-cell"><img alt="stamp1" src="assets/images/stamps/stamp01.png"></div>
            <div class="stamp-cell"><img alt="stamp2" src="assets/images/stamps/stamp02.png"></div>
            <div class="stamp-cell"><img alt="stamp3" src="assets/images/stamps/stamp03.png"></div>
            <div class="stamp-cell"><img alt="stamp4" src="assets/images/stamps/stamp04.png"></div>
            <div class="stamp-cell"><img alt="stamp5" src="assets/images/stamps/stamp05.png"></div>
            <div class="stamp-cell"><img alt="stamp6" src="assets/images/stamps/stamp06.png"></div>
          </div>
        </div>
      </div>

      <!-- å³ï¼šè¨€èªåˆ‡æ›¿ -->
      <div class="mb-right">
        <a id="langBtn" href="#" aria-label="è¨€èªåˆ‡æ›¿">
          <img src="assets/images/ui/lang.png" alt="Lang">
        </a>
      </div>
    </div>
  </div>

  <!-- ãƒšãƒ¼ã‚¸æœ¬ä½“ -->
  <div class="page-container">
    <!-- é”æˆæ™‚ã®è¡Œï¼ˆæ–‡è¨€å¤‰æ›´ï¼šã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ»ã‚¹ãƒšã‚·ãƒ£ãƒ«ï¼‰ -->
    <div id="completeRow" class="complete-row" style="display:none">
      <div>ğŸ‰ 6/6é”æˆãŠã‚ã§ã¨ã†ï¼</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <a id="completeLink" href="post-survey.html">ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã«ç­”ãˆã‚‹</a>
        <a id="specialLink" href="special.html">ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</a>
      </div>
    </div>

    <!-- åœ°å›³ã‚„èµ·å‹•ãƒœã‚¿ãƒ³ã€å†™çœŸãƒ¢ãƒ¼ãƒ€ãƒ«ãªã©ã¯æ—¢å­˜ã® map.js ãŒåˆ¶å¾¡ -->
    <section id="mapRoot">
      <!-- map.js ãŒ DOM ã‚’æ§‹ç¯‰ãƒ»åˆ¶å¾¡ã—ã¾ã™ -->
      <div id="cameraLaunchArea">
        <button id="openCamera" class="btn-primary" type="button">ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•</button>
      </div>
      <div id="spotModalHost"><!-- map.js ãŒå†™çœŸã‚°ãƒªãƒƒãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’æŒ¿å…¥ --></div>
    </section>
  </div>

  <!-- æ—¢å­˜ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
  <script src="js/firebase.js"></script>
  <script src="js/lang.js"></script>
  <script src="js/map.js"></script>

  <script>
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚¹ã‚¿ãƒ¼ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
    if (!window.withV) {
      window.BUILD_V = window.BUILD_V || '20251005';
      window.withV = (url) => url + (url.includes('?') ? '&' : '?') + 'v=' + window.BUILD_V;
    }

    // ---- ã‚¹ã‚¿ãƒ³ãƒ—å¸³ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®ç‹¬ç«‹é–‹é–‰ï¼ˆä»–è¦ç´ ã‚’æŠ¼ã—ä¸‹ã’ãªã„ï¼‰ ----
    (function(){
      const toggleBtn = document.getElementById('stampToggleBtn');
      const book = document.getElementById('stampBook');

      function closeBook(){ book.classList.remove('open'); }
      function toggleBook(ev){
        ev?.preventDefault();
        book.classList.toggle('open');
      }
      toggleBtn.addEventListener('click', toggleBook, { passive: false });

      // å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
      document.addEventListener('click', (e) => {
        if (!book.classList.contains('open')) return;
        const inCenter = e.target.closest('.mb-center');
        if (!inCenter) closeBook();
      });

      // ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã§é–‰ã˜ã‚‹
      document.addEventListener('keydown', (e)=>{
        if (e.key === 'Escape') closeBook();
      });

      // ç”»é¢å›è»¢ã‚„ãƒªã‚µã‚¤ã‚ºæ™‚ã®ä½ç½®ã‚ºãƒ¬å¯¾ç­–ï¼ˆç‰¹ã«iOSï¼‰
      window.addEventListener('resize', ()=>{ /* ä½ç½®ã¯CSSã§ç›¸å¯¾é…ç½®ã®ãŸã‚ç‰¹åˆ¥ãªå‡¦ç†ã¯ä¸è¦ */ });
    })();

    // ---- æ–‡è¨€ã®æ—¢å®šå€¤ã‚’ä¸Šæ›¸ãï¼ˆmap.js ãŒ setText ã—ã¦ã‚‚å•é¡Œãªã„ï¼‰ ----
    (function(){
      try {
        const comp = document.getElementById('completeLink');
        const spec = document.getElementById('specialLink');
        if (comp) comp.textContent = 'ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã«ç­”ãˆã‚‹';
        if (spec) spec.textContent = 'ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„';
      } catch {}
    })();

    // è¨€èªåˆ‡æ›¿ï¼ˆlang.js ã®ä»•æ§˜ã«åˆã‚ã›ã¦å¿…è¦ãªã‚‰æ›¸ãæ›ãˆï¼‰
    (function(){
      const langBtn = document.getElementById('langBtn');
      langBtn?.addEventListener('click', (e)=>{
        e.preventDefault();
        try {
          // lang.js ã«åˆ‡æ›¿APIãŒã‚ã‚‹å ´åˆã¯å‘¼ã¶ã€‚ç„¡ã‘ã‚Œã°ç°¡æ˜“ãƒˆã‚°ãƒ«ã€‚
          const cur = localStorage.getItem('app_lang') || 'ja';
          const next = cur === 'ja' ? 'en' : 'ja';
          localStorage.setItem('app_lang', next);
          location.reload();
        } catch {
          location.href = withV('map.html?lang=en');
        }
      });
    })();
  </script>
</body>
</html>
