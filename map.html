<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>マップ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="css/style.css" />
  <style>
    .map-wrap{position:relative;max-width:900px;margin:12px auto;}
    .map-image{width:100%;height:auto;display:block;border-radius:12px;box-shadow:0 6px 24px rgba(0,0,0,.08);}
    .pin{position:absolute;width:44px;height:44px;transform:translate(-50%,-100%);display:block;border:none;background:transparent;padding:0;cursor:pointer}
    .pin img{width:100%;height:100%;display:block}
    .legend{max-width:900px;margin:8px auto 0;padding:8px 12px;font-size:14px;background:#f6f7fb;border-radius:10px;color:#333}
    .stamp-book{max-width:900px;margin:10px auto;display:none}
    .stamps-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .stamp-cell{background:#fff;border-radius:12px;padding:12px;box-shadow:0 4px 16px rgba(0,0,0,.06);text-align:center}
    .stamp-img{width:100%;max-width:140px;height:auto;display:block;margin:6px auto 4px}
    .stamp-placeholder{width:100%;max-width:140px;margin:6px auto 4px;padding:28px 0;border:2px dashed #c7c7c7;border-radius:10px;color:#888;font-weight:600}
    .stamp-status{font-size:13px;font-weight:600;margin-top:2px}
    .obtained{color:#1a7f37}.not-obtained{color:#b02a37}
    /* === Spot Picker Modal === */
.spot-modal-backdrop {
  position: fixed; inset: 0; background: rgba(0,0,0,.35); display: none; z-index: 9998;
}
.spot-modal {
  position: fixed; left: 50%; top: 50%; transform: translate(-50%,-50%);
  width: min(92vw, 420px); background: #fff; border-radius: 16px; box-shadow: 0 24px 60px rgba(0,0,0,.25);
  padding: 18px; display: none; z-index: 9999;
}
.spot-modal h3 { margin: 0 0 8px; font-size: 18px; }
.spot-list { display: grid; gap: 10px; margin-top: 8px; }
.spot-item { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border: 1.5px solid #e7e7e7; border-radius: 12px; cursor: pointer; }
.spot-item:hover { border-color: #0a58ca; background: #f6f9ff; }
.spot-item img { width: 40px; height: 40px; border-radius: 8px; object-fit: cover; background:#f2f2f2; }
.spot-actions { display: flex; justify-content: flex-end; gap: 8px; margin-top: 12px; }
.btn { padding: 10px 14px; border-radius: 10px; border: 0; cursor: pointer; font-weight: 600; }
.btn-cancel { background: #e9ecef; color: #333; }

  </style>
  <script src="js/firebase.js" defer></script>
  <script src="js/map.js" defer></script>
</head>
<body>
  <div style="max-width:900px;margin:0 auto;display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
    <a href="tutorial.html">チュートリアル</a> |
    <button id="stampToggle" type="button">▼スタンプ帳</button>
  </div>

  <div id="stampBook" class="stamp-book">
    <div class="stamps-grid">
      <div class="stamp-cell" data-spot="spot1">
        <div>スポット1</div>
        <img id="stamp1Img" class="stamp-img" src="assets/images/stamp01.png" alt="スタンプ1" style="display:none;">
        <div id="stamp1Placeholder" class="stamp-placeholder">未取得</div>
        <div id="stamp1Status" class="stamp-status not-obtained">未取得</div>
      </div>
      <div class="stamp-cell" data-spot="spot2">
        <div>スポット2</div>
        <img id="stamp2Img" class="stamp-img" src="assets/images/stamp02.png" alt="スタンプ2" style="display:none;">
        <div id="stamp2Placeholder" class="stamp-placeholder">未取得</div>
        <div id="stamp2Status" class="stamp-status not-obtained">未取得</div>
      </div>
      <div class="stamp-cell" data-spot="spot3">
        <div>スポット3</div>
        <img id="stamp3Img" class="stamp-img" src="assets/images/stamp03.png" alt="スタンプ3" style="display:none;">
        <div id="stamp3Placeholder" class="stamp-placeholder">未取得</div>
        <div id="stamp3Status" class="stamp-status not-obtained">未取得</div>
      </div>
    </div>
  </div>

  <div class="map-wrap">
    <img src="assets/images/campus-map.png" alt="マップ" class="map-image" id="mapImage" />
    <!-- ピン（例）: data- 属性は経路遷移に使う -->
    <button class="pin" data-spot="spot1" data-label="Spot1" data-lat="35.686917" data-lng="139.529194" style="left:32%;top:58%;">
      <img src="assets/images/map_pin.png" alt="1">
    </button>
    <button class="pin" data-spot="spot2" data-label="Spot2" data-lat="35.686139" data-lng="139.533056" style="left:61%;top:41%;">
      <img src="assets/images/map_pin.png" alt="2">
    </button>
    <button class="pin" data-spot="spot3" data-label="Spot3" data-lat="35.685667" data-lng="139.530889" style="left:78%;top:72%;">
      <img src="assets/images/map_pin.png" alt="3">
    </button>
  </div>

  <div class="legend"><p>ピンをタップすると地図アプリが開きます。現地で<strong>カメラ起動</strong>からARへ進んでください。</p></div>

  <div style="max-width:900px;margin:12px auto;text-align:center">
    <button id="cameraBtn" type="button">カメラ起動</button>
  </div>
  <!-- Spot Picker Modal -->
<div id="spotBackdrop" class="spot-modal-backdrop"></div>
<div id="spotModal" class="spot-modal" role="dialog" aria-modal="true" aria-labelledby="spotModalTitle">
  <h3 id="spotModalTitle">スポットを選んでカメラを起動</h3>
  <div class="spot-list">
    <div class="spot-item" data-spot="spot1">
      <img src="assets/images/stamp01.png" alt="スポット1">
      <div>
        <div>スポット1</div>
        <small>史料館前</small>
      </div>
    </div>
    <div class="spot-item" data-spot="spot2">
      <img src="assets/images/stamp02.png" alt="スポット2">
      <div>
        <div>スポット2</div>
        <small>時計台</small>
      </div>
    </div>
    <div class="spot-item" data-spot="spot3">
      <img src="assets/images/stamp03.png" alt="スポット3">
      <div>
        <div>スポット3</div>
        <small>中庭</small>
      </div>
    </div>
  </div>
  <div class="spot-actions">
    <button id="spotCancel" class="btn btn-cancel" type="button">キャンセル</button>
  </div>
</div>

</body>
</html>