<!DOCTYPE html> 
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>„Éû„ÉÉ„Éó | AR„Çπ„Çø„É≥„Éó„É©„É™„Éº</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="stylesheet" href="css/style.css" />
  <style>
    :root{
      --accent:#005ABB;
      --bg:#fff;
      --text:#111;
      --muted:#666;
      --container: 980px;
      --radius: 16px;
      --menuShadow:0 10px 28px rgba(0,0,0,.15);
    }
    html,body{background:var(--bg);color:var(--text);margin:0}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;line-height:1.6}

    .wrap{max-width:var(--container);margin:0 auto;padding:clamp(10px,3vw,14px)}
    a.link{color:var(--accent);text-decoration:none;font-weight:800}

    .top-grid{
      display:grid;
      grid-template-columns: 1fr 2fr 1fr;
      gap:8px; align-items:center;
      margin-bottom:clamp(10px,3vw,14px);
    }
    @media (max-width:560px){ .top-grid{grid-template-columns: 1fr 1fr 1fr} }
    .top-cell{display:flex;align-items:center}
    .top-cell.left{justify-content:flex-start; gap:12px; flex-wrap:wrap}
    .top-cell.center{justify-content:center}
    .top-cell.right{justify-content:flex-end; position:relative}

    /* „Çπ„Çø„É≥„ÉóÂ∏≥Ôºà„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥Ôºâ */
    .stampbook{ position:relative; width:100%; max-width:520px; background:#fff;border:1px solid #e9eef6;border-radius:14px; box-shadow:0 6px 24px rgba(0,0,0,.05); overflow:visible; z-index:20; }
    .stampbook-header{ width:100%; text-align:center; background:#fff; color:#111; appearance:none;border:0; padding:12px 14px; font-weight:900; letter-spacing:.02em; display:flex;align-items:center;justify-content:center; gap:10px; cursor:pointer; }
    .stampbook-header .arrow{color:#333}
    .stampbook-body{
      position:absolute; left:0; right:0; top:calc(100% + 6px);
      display:none; padding:10px 12px 12px; background:#fff; border:1px solid #e9eef6; border-radius:14px; box-shadow:0 18px 48px rgba(0,0,0,.18); max-height:60vh; overflow:auto;
    }

    .stamp-count{font-size:13px;color:#333}
    .stamp-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
    .stamp-cell{border:1px solid #e3eaf6;border-radius:12px;padding:10px;min-height:72px;background:#fff;display:flex;align-items:center;gap:10px}
    .stamp-thumb{width:52px;height:52px;border-radius:10px;background:#eef5ff;flex:none;overflow:hidden;display:flex;align-items:center;justify-content:center}
    .stamp-thumb img{width:100%;height:100%;object-fit:cover}
    .stamp-meta{flex:1}
    .stamp-name{font-weight:800}
    .stamp-status{font-size:12px;color:#333}
    .stamp-cell.is-got{background:#f3fbf5;border-color:#b7e4c7}
    .stamp-cell.is-got .stamp-status{color:#2b8a3e;font-weight:800}
    .mark{font-weight:700}
    .complete-inline{margin:8px 0 0;text-align:center;display:none}
    .complete-inline a{color:var(--accent);text-decoration:none;font-weight:900}

    /* Ë®ÄË™û„Ç¢„Ç§„Ç≥„É≥Ôºã„É°„Éã„É•„Éº */
    .lang-btn{appearance:none;border:0;background:#fff;border:1px solid #e3eaf6;border-radius:12px;padding:6px;cursor:pointer;box-shadow:var(--menuShadow)}
    .lang-btn:focus-visible{outline:3px solid rgba(0,90,187,.35)}
    .lang-icon{width:28px;height:28px;display:block}
    .lang-menu{position:absolute; right:0; top:44px; background:#fff; border:1px solid #e3eaf6; border-radius:12px; box-shadow:var(--menuShadow); display:none; min-width:160px; overflow:hidden; z-index:50}
    .lang-menu.is-open{display:block}
    .lang-item{display:block;width:100%;text-align:left;background:#fff;border:0;padding:10px 12px;cursor:pointer;font-weight:800}
    .lang-item:hover{background:#f2f6ff}

    .map-wrap{ position:relative;width:100%;max-width:920px;margin:0 auto 14px;background:#fff; border-radius:var(--radius);box-shadow:0 10px 30px rgba(0,0,0,.05);overflow:hidden; }
    .map-img{display:block;width:100%;height:auto;object-fit:contain;background:#fff}
    .pin{ position:absolute;width:40px;height:40px;transform:translate(-50%,-100%); display:inline-block; }
    .pin img{width:100%;height:100%;display:block}
    .pin:focus-visible{outline:3px solid rgba(0,90,187,.35);border-radius:50%}

    .hint{ max-width:920px;margin:10px auto;color:#333;background:#f6f7fb;border:1px solid #e9eef6; border-radius:12px;padding:10px 12px;font-size:14px }

    .footer-cta{ position:sticky;bottom:0;left:0;right:0;z-index:5;background:linear-gradient(to top,#fff,#fff 70%,rgba(255,255,255,0)); padding:10px 0 max(12px, env(safe-area-inset-bottom)); }
    .btn{ appearance:none;border:0;border-radius:12px;padding:14px 16px;font-weight:900; background:var(--accent);color:#fff;cursor:pointer;width:100%;box-shadow:0 10px 30px rgba(0,90,187,.25) }
    .btn-secondary{background:#e9eef6;color:#111;box-shadow:none}

    .camera-chooser-overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(2px);z-index:998;display:none}
    .camera-chooser-overlay.is-open{display:block}
    .camera-chooser{ position:fixed;left:50%;top:50%;transform:translate(-50%,-50%); width:min(94vw,560px);max-height:78vh;overflow:auto;background:#fff;border-radius:16px; box-shadow:0 18px 48px rgba(0,0,0,.3);padding:14px;z-index:999;display:none }
    .camera-chooser.is-open{display:block}
    .camera-chooser h3{margin:0 0 8px;font-size:18px}
    .camera-chooser p{margin:0 0 10px;color:#333}
    .camera-chooser .list{ display:grid; grid-template-columns:repeat(2, 1fr); gap:10px; }
    @media (min-width:520px){ .camera-chooser .list{ grid-template-columns:repeat(3, 1fr); } }
    .camera-chooser .item{ padding:0; border:none; background:transparent }
    .thumbWrap{ position:relative; aspect-ratio:1/1; border-radius:12px; overflow:hidden; border:1px solid #e3eaf6; box-shadow:0 10px 26px rgba(0,0,0,.12); background:#f3f6fc; }
    .thumbWrap img{ width:100%; height:100%; object-fit:cover; display:block; background:linear-gradient(90deg,#f2f5fb 25%,#e8eef9 37%,#f2f5fb 63%); background-size:400% 100%; animation: shimmer 1.4s ease infinite; }
    @keyframes shimmer{0%{background-position:100% 0}100%{background-position:0 0}}
    .thumbWrap .label{ position:absolute; left:8px; right:8px; bottom:8px; font-weight:900; font-size:13px; line-height:1.2; color:#fff; text-shadow:-1px -1px 0 #2b3a68, 1px -1px 0 #2b3a68, -1px 1px 0 #2b3a68, 1px 1px 0 #2b3a68; background:linear-gradient(to top, rgba(0,0,0,.45), rgba(0,0,0,0)); padding:8px 10px 10px; border-radius:0 0 10px 10px; }

    .complete-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(2px);z-index:1000;display:none}
    .complete-overlay.is-open{display:block}
    .complete-modal{ position:fixed;left:50%;top:50%;transform:translate(-50%,-50%); width:min(92vw,560px);max-height:80vh;overflow:auto;background:#fff;border-radius:18px; box-shadow:0 20px 60px rgba(0,0,0,.35);padding:20px;z-index:1001;display:none }
    .complete-modal.is-open{display:block}
    .complete-title{margin:0 0 6px;font-size:20px}
    .complete-lead{margin:0 0 14px}
    .complete-row{display:flex;gap:8px;flex-wrap:wrap}

    .stamp-cell .stamp-thumb img { opacity:0; filter: grayscale(0.2); transition: opacity .2s }
    .stamp-cell.is-got .stamp-thumb img { opacity:1; filter:none }
  </style>
</head>
<body>
  <div id="pageRoot">
    <div class="wrap">
      <!-- ‰∏äÈÉ® -->
      <div class="top-grid" aria-label="‰∏äÈÉ®„É°„Éã„É•„Éº">
        <!-- Â∑¶ÔºöË¶èÁ¥ÑÔºã„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´ -->
        <div class="top-cell left">
          <a class="link" href="terms.html" data-i18n="map.terms">„Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº„Éª„ÅîÂà©Áî®‰∏ä„ÅÆÊ≥®ÊÑè</a>
          <a class="link" href="tutorial.html" data-i18n="map.tutorial">„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´</a>
        </div>

        <!-- ‰∏≠Â§ÆÔºö„Çπ„Çø„É≥„ÉóÂ∏≥ -->
        <div class="top-cell center">
          <section class="stampbook" aria-label="„Çπ„Çø„É≥„ÉóÂ∏≥">
            <button id="stampToggle" class="stampbook-header" type="button" aria-expanded="false" aria-controls="stampBody">
              <span class="arrow">‚ñº</span><span data-i18n="map.stampbook">„Çπ„Çø„É≥„ÉóÂ∏≥</span>
              <span class="stamp-count" id="stampCount" style="margin-left:8px">0/6</span>
            </button>

            <!-- „Ç≥„É≥„Éó„É™„Éº„ÉàÊôÇ„É™„É≥„ÇØ -->
            <div id="completeInline" class="complete-inline">
              <a href="post-survey.html" data-i18n="map.toSurveyInline">üìù „Ç¢„É≥„Ç±„Éº„Éà„Å´Á≠î„Åà„Çã</a>
            </div>
            <div id="specialInline" class="complete-inline" style="display:none">
              <a href="special.html" data-i18n="map.special">üåü „Çπ„Éö„Ç∑„É£„É´„Ç≥„É≥„ÉÜ„É≥„ÉÑ</a>
            </div>

            <div id="stampBody" class="stampbook-body" role="region" aria-label="„Çπ„Çø„É≥„Éó‰∏ÄË¶ß">
              <div class="stamp-grid">
                <div class="stamp-cell" data-spot="spot1">
                  <div class="stamp-thumb"><img src="assets/images/stamps/stamp01.png" alt="„Çπ„Çø„É≥„Éó1"></div>
                  <div class="stamp-meta"><div class="stamp-name" data-i18n="spots.s1">Êú¨È§®173Ââç</div><div class="stamp-status"><span class="mark" data-i18n="map.notgot">Êú™ÂèñÂæó</span></div></div>
                </div>
                <div class="stamp-cell" data-spot="spot2">
                  <div class="stamp-thumb"><img src="assets/images/stamps/stamp02.png" alt="„Çπ„Çø„É≥„Éó2"></div>
                  <div class="stamp-meta"><div class="stamp-name" data-i18n="spots.s2">„Éà„É≠„Ç§„É§„ÉºË®òÂøµÈ§®ÔºàTÈ§®ÔºâÂâç</div><div class="stamp-status"><span class="mark" data-i18n="map.notgot">Êú™ÂèñÂæó</span></div></div>
                </div>
                <div class="stamp-cell" data-spot="spot3">
                  <div class="stamp-thumb"><img src="assets/images/stamps/stamp03.png" alt="„Çπ„Çø„É≥„Éó3"></div>
                  <div class="stamp-meta"><div class="stamp-name" data-i18n="spots.s3">Â≠¶ÁîüÈ£üÂ†ÇÔºà„Ç¨„ÉÉ„Ç≠ÔºâÂâç</div><div class="stamp-status"><span class="mark" data-i18n="map.notgot">Êú™ÂèñÂæó</span></div></div>
                </div>
                <div class="stamp-cell" data-spot="spot4">
                  <div class="stamp-thumb"><img src="assets/images/stamps/stamp04.png" alt="„Çπ„Çø„É≥„Éó4"></div>
                  <div class="stamp-meta"><div class="stamp-name" data-i18n="spots.s4">„ÉÅ„É£„Éö„É´Ââç</div><div class="stamp-status"><span class="mark" data-i18n="map.notgot">Êú™ÂèñÂæó</span></div></div>
                </div>
                <div class="stamp-cell" data-spot="spot5">
                  <div class="stamp-thumb"><img src="assets/images/stamps/stamp05.png" alt="„Çπ„Çø„É≥„Éó5"></div>
                  <div class="stamp-meta"><div class="stamp-name" data-i18n="spots.s5">‰ΩìËÇ≤È§®ÔºàPec-AÔºâÂâç</div><div class="stamp-status"><span class="mark" data-i18n="map.notgot">Êú™ÂèñÂæó</span></div></div>
                </div>
                <div class="stamp-cell" data-spot="spot6">
                  <div class="stamp-thumb"><img src="assets/images/stamps/stamp06.png" alt="„Çπ„Çø„É≥„Éó6"></div>
                  <div class="stamp-meta"><div class="stamp-name" data-i18n="spots.s6">Êú¨È§®307Ââç</div><div class="stamp-status"><span class="mark" data-i18n="map.notgot">Êú™ÂèñÂæó</span></div></div>
                </div>
              </div>
            </div>
          </section>
        </div>

        <!-- Âè≥ÔºöË®ÄË™û -->
        <div class="top-cell right">
          <button id="langBtn" class="lang-btn" type="button" aria-haspopup="true" aria-expanded="false" aria-controls="langMenu">
            <img class="lang-icon" src="assets/images/ui/lang.png" alt="Ë®ÄË™û / Language">
          </button>
          <div id="langMenu" class="lang-menu" role="menu" aria-label="Language">
            <button class="lang-item" data-lang="ja" role="menuitem">Êó•Êú¨Ë™û</button>
            <button class="lang-item" data-lang="en" role="menuitem">English</button>
          </div>
        </div>
      </div>

      <!-- Âú∞Âõ≥ -->
      <div class="map-wrap" aria-label="„Ç≠„É£„É≥„Éë„Çπ„Éû„ÉÉ„Éó">
        <img class="map-img" src="assets/images/campasMap.png" alt="„Ç≠„É£„É≥„Éë„ÇπÂú∞Âõ≥" />
      </div>

      <!-- „Ç´„É°„É©Ëµ∑Âãï -->
      <div class="footer-cta">
        <button id="cameraBtn" class="btn" data-i18n="map.openAR">ARËµ∑Âãï</button>
      </div>
    </div>
  </div>

  <!-- „Çπ„Éù„ÉÉ„ÉàÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
  <div id="cameraChooserOverlay" class="camera-chooser-overlay" aria-hidden="true"></div>
  <div id="cameraChooser" class="camera-chooser" role="dialog" aria-modal="true" aria-labelledby="cameraChooserTitle" aria-describedby="cameraChooserDesc">
    <h3 id="cameraChooserTitle" data-i18n="map.chooseSpot">„Çπ„Éù„ÉÉ„Éà„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ</h3>
    <p id="cameraChooserDesc" style="margin:0 0 10px;color:#333" data-i18n="map.tapToOpen">ÂÜôÁúü„Çí„Çø„ÉÉ„Éó„Åô„Çã„Å®AR„ÅåËµ∑Âãï„Åó„Åæ„Åô„ÄÇ</p>
    <div id="cameraChooserList" class="list"></div>
    <div style="margin-top:10px;text-align:right">
      <button id="cameraChooserClose" class="btn btn-secondary" type="button" data-i18n="common.close">Èñâ„Åò„Çã</button>
    </div>
  </div>

  <!-- ÂÆåËµ∞„É¢„Éº„ÉÄ„É´ -->
  <div id="completeOverlay" class="complete-overlay" aria-hidden="true"></div>
  <div id="completeModal" class="complete-modal" role="dialog" aria-modal="true" aria-labelledby="completeTitle" aria-describedby="completeLead">
    <h2 id="completeTitle" class="complete-title" data-i18n="map.completedTitle">üéâ „Ç≥„É≥„Éó„É™„Éº„ÉàÔºÅ</h2>
    <p id="completeLead" class="complete-lead" data-i18n="map.completedLead">ÂÖ®„Å¶„ÅÆ„Çπ„Çø„É≥„Éó„ÇíÈõÜ„ÇÅ„Åæ„Åó„Åü„ÄÇ„ÅîÂèÇÂä†„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ</p>
    <div class="complete-row">
      <button id="closeComplete" class="btn btn-secondary" type="button" data-i18n="common.backToMap">„Éû„ÉÉ„Éó„Å´Êàª„Çã</button>
      <a id="toSurvey" class="btn" href="post-survey.html" data-i18n="map.toSurvey">„Ç¢„É≥„Ç±„Éº„Éà„Å∏</a>
    </div>
  </div>

  <!-- Êäò„ÇäÁï≥„Åø„ÉªË®ÄË™û„É°„Éã„É•„Éº -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const btn = document.getElementById('stampToggle');
      const body = document.getElementById('stampBody');
      const arrow = btn?.querySelector('.arrow');
      btn?.addEventListener('click', () => {
        const open = body.style.display === 'block';
        body.style.display = open ? 'none' : 'block';
        btn.setAttribute('aria-expanded', open ? 'false' : 'true');
        if (arrow) arrow.textContent = open ? '‚ñº' : '‚ñ≤';
      });

      // Ë®ÄË™û„É°„Éã„É•„Éº
      const langBtn = document.getElementById('langBtn');
      const langMenu= document.getElementById('langMenu');
      const items   = langMenu?.querySelectorAll('.lang-item');
      const open = (v)=>{ langMenu.classList.toggle('is-open', v); langBtn.setAttribute('aria-expanded', v ? 'true':'false'); };
      langBtn?.addEventListener('click', (e)=>{ e.stopPropagation(); open(!langMenu.classList.contains('is-open')); });
      document.addEventListener('click', ()=> open(false));
      items?.forEach(it=>{
        it.addEventListener('click', ()=>{
          const lang = it.dataset.lang || 'ja';
          try { localStorage.setItem('app_lang', lang); } catch(e){}
          if (typeof window.applyLang === 'function') { window.applyLang(lang); }
          else { location.reload(); }
        });
      });
    });
  </script>

  <script src="js/firebase.js" defer></script>
  <script src="js/map.js?v=20251003" defer></script>
</body>
</html>
