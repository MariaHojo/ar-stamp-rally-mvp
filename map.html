<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>マップ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="stylesheet" href="css/style.css" />
  <style>
    :root{
      --accent:#005ABB;
    }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#fff;color:#111}
    .container{max-width:960px;margin:0 auto;padding:12px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .btn{appearance:none;border:0;border-radius:12px;padding:12px 16px;font-weight:800;background:var(--accent);color:#fff;cursor:pointer}
    .btn-secondary{background:#e9eef6;color:#111}
    .link{color:var(--accent);text-decoration:none;font-weight:700}

    .legend{margin:10px 0 14px;padding:10px 12px;font-size:14px;background:#f6f7fb;border-radius:10px;color:#333}

    /* ====== 地図 ====== */
    .map-wrap{
      position:relative;
      width:100%;
      max-width:920px;
      margin:0 auto 14px;
      background:#fff;
      border-radius:16px;
      box-shadow:0 10px 30px rgba(0,0,0,.05);
      overflow:hidden;
    }
    .map-img{
      display:block;
      width:100%;
      height:auto;
      object-fit:contain;
      background:#fff;
    }
    .pin{
      position:absolute;
      width:40px; height:40px;
      transform:translate(-50%,-100%); /* 先端が指すように上に合わせる */
      display:inline-block;
    }
    .pin img{width:100%; height:100%; display:block}
    .pin:focus-visible{outline:3px solid rgba(0,90,187,.35); border-radius:50%}

    /* ====== スタンプ帳（折りたたみ） ====== */
    .stampbook{
      margin:0 auto 18px;
      background:#fff;border:1px solid #e9eef6;border-radius:14px;
      box-shadow:0 8px 24px rgba(0,0,0,.05);
      overflow:hidden;
      max-width:920px;
    }
    .stampbook-header{
      width:100%; text-align:left; background:#fff; color:#111;
      appearance:none;border:0; padding:14px 16px; font-weight:900; letter-spacing:.02em;
      display:flex;align-items:center;justify-content:space-between; cursor:pointer;
    }
    .stampbook-header .arrow{margin-right:2px;color:#333}
    .stampbook-body{display:none;padding:12px 12px 16px;background:#fff}
    .stamp-grid{
      display:grid; grid-template-columns: repeat(3, 1fr); gap:10px;
    }
    .stamp-cell{
      border:1px solid #e3eaf6;border-radius:12px;padding:10px;min-height:72px;
      background:#fff;display:flex;align-items:center;gap:10px
    }
    .stamp-thumb{width:56px;height:56px;border-radius:10px;background:#eef5ff;flex:none;overflow:hidden;display:flex;align-items:center;justify-content:center}
    .stamp-thumb img{width:100%;height:100%;object-fit:cover}
    .stamp-meta{flex:1}
    .stamp-name{font-weight:800}
    .stamp-status{font-size:12px;color:#333}
    .stamp-cell.is-got{background: #f3fbf5; border-color:#b7e4c7}
    .stamp-cell.is-got .stamp-status{color:#2b8a3e; font-weight:800}
    .mark{font-weight:700}

    /* ====== カメラ吹き出し（既存） ====== */
    .camera-chooser-overlay{
      position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(2px);
      z-index:998;display:block;
    }
    .camera-chooser{
      position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);
      width:min(92vw,560px);max-height:75vh;overflow:auto;background:#fff;border-radius:16px;
      box-shadow:0 18px 48px rgba(0,0,0,.3);padding:16px;z-index:999;
    }
    .camera-chooser[hidden], .camera-chooser-overlay[hidden]{display:none}
    .camera-chooser h3{margin:0 0 10px;font-size:18px}
    .camera-chooser .list{display:grid;grid-template-columns:1fr;gap:8px}
    .camera-chooser .item{display:flex;gap:10px;align-items:center;border:1px solid #e3eaf6;border-radius:12px;padding:10px}
    .camera-chooser .thumb{width:56px;height:56px;border-radius:10px;background:#eef5ff;flex:none;overflow:hidden}
    .camera-chooser .thumb img{width:100%;height:100%;object-fit:cover}
    .camera-chooser .meta{flex:1}
    .camera-chooser .meta .name{font-weight:800}
    .camera-chooser .meta .type{font-size:12px;color:#333}
    .camera-chooser .go{white-space:nowrap}

    /* ====== 完走モーダル（既存：complete.html相当） ====== */
    .complete-overlay{
      position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(2px);
      z-index:1000;display:none;
    }
    .complete-overlay.is-open{display:block}
    .complete-modal{
      position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);
      width:min(92vw,560px);max-height:80vh;overflow:auto;background:#fff;border-radius:18px;
      box-shadow:0 20px 60px rgba(0,0,0,.35);padding:20px;z-index:1001;display:none;
    }
    .complete-modal.is-open{display:block}
    .complete-title{margin:0 0 6px;font-size:20px}
    .complete-lead{margin:0 0 14px}
    .complete-row{display:flex;gap:8px;flex-wrap:wrap}
    .complete-row .btn{flex:1;min-width:160px}
    .dim-when-modal{transition:opacity .2s ease}
    .dim-when-modal.is-dim{opacity:.15;pointer-events:none}

    footer{margin:16px auto 24px;max-width:960px;color:#333}
    footer a{color:var(--accent);text-decoration:none;font-weight:700}
  </style>
</head>
<body>
  <div id="pageRoot" class="dim-when-modal">
    <div class="container">
      <header class="row">
        <button id="cameraBtn" class="btn">カメラ起動</button>
        <a class="btn btn-secondary" href="tutorial.html">チュートリアル</a>
      </header>

      <div class="legend">
        マップからスポットを選び、ARでスタンプを集めましょう（全6箇所：AR 1〜3、非AR 4〜6）。
      </div>

      <!-- ====== 中央の地図表示（画像） ====== -->
      <div class="map-wrap" aria-label="キャンパスマップ">
        <img class="map-img" src="assets/images/campasMap.png" alt="キャンパス地図" />

        <!-- ★ 地図アプリへのリンクは後で埋め込み予定：href は空でOK -->
        <!-- 座標は%で仮配置。後で微調整してください。 -->
        <a href="" class="pin" data-spot="spot1" style="left:22%;top:38%;" aria-label="スポット1">
          <img src="assets/images/map_pin.png" alt="スポット1ピン" />
        </a>
        <a href="" class="pin" data-spot="spot2" style="left:48%;top:28%;" aria-label="スポット2">
          <img src="assets/images/map_pin.png" alt="スポット2ピン" />
        </a>
        <a href="" class="pin" data-spot="spot3" style="left:72%;top:46%;" aria-label="スポット3">
          <img src="assets/images/map_pin.png" alt="スポット3ピン" />
        </a>
        <a href="" class="pin" data-spot="spot4" style="left:30%;top:62%;" aria-label="スポット4">
          <img src="assets/images/map_pin.png" alt="スポット4ピン" />
        </a>
        <a href="" class="pin" data-spot="spot5" style="left:55%;top:68%;" aria-label="スポット5">
          <img src="assets/images/map_pin.png" alt="スポット5ピン" />
        </a>
        <a href="" class="pin" data-spot="spot6" style="left:80%;top:60%;" aria-label="スポット6">
          <img src="assets/images/map_pin.png" alt="スポット6ピン" />
        </a>
      </div>

      <!-- ====== スタンプ帳（折りたたみ） ====== -->
      <section class="stampbook" aria-label="スタンプ帳">
        <button id="stampToggle" class="stampbook-header" type="button" aria-expanded="false" aria-controls="stampBody">
          <span><span class="arrow">▼</span> スタンプ帳</span>
          <span id="stampCount">0/6</span>
        </button>
        <div id="stampBody" class="stampbook-body">
          <div class="stamp-grid">
            <!-- spot1〜spot6：map.js が .is-got を付与し、.mark に文言反映 -->
            <div class="stamp-cell" data-spot="spot1">
              <div class="stamp-thumb"><img src="assets/images/stamp01.png" alt="スタンプ1"></div>
              <div class="stamp-meta">
                <div class="stamp-name">スポット1</div>
                <div class="stamp-status"><span class="mark">未取得</span></div>
              </div>
            </div>
            <div class="stamp-cell" data-spot="spot2">
              <div class="stamp-thumb"><img src="assets/images/stamp02.png" alt="スタンプ2"></div>
              <div class="stamp-meta">
                <div class="stamp-name">スポット2</div>
                <div class="stamp-status"><span class="mark">未取得</span></div>
              </div>
            </div>
            <div class="stamp-cell" data-spot="spot3">
              <div class="stamp-thumb"><img src="assets/images/stamp03.png" alt="スタンプ3"></div>
              <div class="stamp-meta">
                <div class="stamp-name">スポット3</div>
                <div class="stamp-status"><span class="mark">未取得</span></div>
              </div>
            </div>
            <div class="stamp-cell" data-spot="spot4">
              <div class="stamp-thumb"><img src="assets/images/stamp01.png" alt="スタンプ4"></div>
              <div class="stamp-meta">
                <div class="stamp-name">スポット4</div>
                <div class="stamp-status"><span class="mark">未取得</span></div>
              </div>
            </div>
            <div class="stamp-cell" data-spot="spot5">
              <div class="stamp-thumb"><img src="assets/images/stamp02.png" alt="スタンプ5"></div>
              <div class="stamp-meta">
                <div class="stamp-name">スポット5</div>
                <div class="stamp-status"><span class="mark">未取得</span></div>
              </div>
            </div>
            <div class="stamp-cell" data-spot="spot6">
              <div class="stamp-thumb"><img src="assets/images/stamp03.png" alt="スタンプ6"></div>
              <div class="stamp-meta">
                <div class="stamp-name">スポット6</div>
                <div class="stamp-status"><span class="mark">未取得</span></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 完了リンク（任意、常時リンク） -->
      <div id="completeLinkArea" style="margin:6px 0 0;">
        <a class="link" href="complete.html">🎉 コンプリートを確認する</a>
      </div>
    </div>

    <!-- 利用規約リンク（復活） -->
    <footer>
      <a href="terms.html">利用規約・プライバシー</a>
    </footer>
  </div>

  <!-- 既存：スポット選択の吹き出し -->
  <div id="cameraChooserOverlay" class="camera-chooser-overlay" hidden></div>
  <div id="cameraChooser" class="camera-chooser" hidden role="dialog" aria-modal="true" aria-labelledby="cameraChooserTitle">
    <h3 id="cameraChooserTitle">スポットを選んでください</h3>
    <div id="cameraChooserList" class="list"></div>
    <div class="row" style="margin-top:8px"><button id="cameraChooserClose" class="btn btn-secondary" type="button">キャンセル</button></div>
  </div>

  <!-- 完走モーダル（complete.html相当） -->
  <div id="completeOverlay" class="complete-overlay" aria-hidden="true"></div>
  <div id="completeModal" class="complete-modal" role="dialog" aria-modal="true" aria-labelledby="completeTitle" aria-describedby="completeLead">
    <h2 id="completeTitle" class="complete-title">🎉 コンプリート！</h2>
    <p id="completeLead" class="complete-lead">全てのスタンプを集めました。ご参加ありがとうございます！</p>
    <div class="complete-row" style="margin-top:8px">
      <button id="closeComplete" class="btn btn-secondary" type="button">マップに戻る</button>
      <a id="toSurvey" class="btn" href="post-survey.html">アンケートへ（お答えいただいた方にはスペシャルコンテンツがあります！）</a>
    </div>
  </div>

  <!-- スクリプト -->
  <script>
    // スタンプ帳の開閉（軽量な内蔵スクリプト。既存map.jsに影響しません）
    document.addEventListener('DOMContentLoaded', () => {
      const btn = document.getElementById('stampToggle');
      const body = document.getElementById('stampBody');
      const arrow = btn?.querySelector('.arrow');
      btn?.addEventListener('click', () => {
        const open = body.style.display === 'block';
        body.style.display = open ? 'none' : 'block';
        btn.setAttribute('aria-expanded', open ? 'false' : 'true');
        if (arrow) arrow.textContent = open ? '▼' : '▲';
      });
    });
  </script>
  <script src="js/firebase.js" defer></script>
  <script src="js/map.js?v=20250926c" defer></script>
</body>
</html>
