<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>アンケート | ARスタンプラリー</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="stylesheet" href="css/style.css" />
  <style>
    .lang-switch{position:fixed; right:12px; top:12px; z-index:2147483647}
    .lang-btn{
      appearance:none;border:0;background:#fff;border:1px solid #e3eaf6;border-radius:12px;
      padding:6px; cursor:pointer; box-shadow:0 10px 28px rgba(0,0,0,.15)
    }
    .lang-btn:focus-visible{outline:3px solid rgba(0,90,187,.35)}
    .lang-icon{width:28px;height:28px;display:block}
    .lang-menu{
      position:absolute; right:0; margin-top:8px; background:#fff; border:1px solid #e3eaf6; border-radius:12px;
      box-shadow:0 10px 28px rgba(0,0,0,.15); display:none; min-width:160px; overflow:hidden
    }
    .lang-menu.is-open{display:block}
    .lang-item{display:block; width:100%; text-align:left; background:#fff; border:0; padding:10px 12px; cursor:pointer; font-weight:800}
    .lang-item:hover{background:#f2f6ff}
  </style>
</head>
<body>
  <!-- 言語スイッチ（共通） -->
  <div class="lang-switch" id="langSwitch">
    <button id="langBtn" class="lang-btn" type="button" aria-haspopup="true" aria-expanded="false" aria-controls="langMenu">
      <img class="lang-icon" src="assets/images/ui/lang.png" alt="言語 / Language">
    </button>
    <div id="langMenu" class="lang-menu" role="menu" aria-label="Language">
      <button class="lang-item" data-lang="ja" role="menuitem">日本語</button>
      <button class="lang-item" data-lang="en" role="menuitem">English</button>
    </div>
  </div>

  <!-- ここから既存のアンケート本文（単一の <body> 内に統合） -->
  <div class="wrap">
    <header>
      <h1>アンケート</h1>
    </header>

    <form id="surveyForm" novalidate>
      <!-- あなたについて -->
      <section class="section" aria-labelledby="aboutYou">
        <h2 class="sec-title" id="aboutYou">あなたについて</h2>

        <!-- 年代（必須） -->
        <div class="field" id="f-age">
          <div class="label-row">
            <label for="age">年代</label><span class="req">*必須</span>
          </div>
          <div class="hint">半角数字で入力</div>
          <div class="age-row">
            <input id="age" name="age" class="age-input" type="tel" inputmode="numeric" pattern="[0-9]*" placeholder="18" aria-describedby="ageErr" />
            <span class="age-suffix">歳</span>
          </div>
          <div class="err" id="ageErr">年代（年齢）を半角数字で入力してください。</div>
        </div>

        <!-- 歴史に興味（必須） -->
        <div class="field" id="f-histInterest">
          <div class="label-row"><label>歴史に興味があるか</label><span class="req">*必須</span></div>
          <div class="likert" data-name="hist_interest" role="radiogroup" aria-describedby="histInterestScale histInterestErr">
            <label class="radio-pill"><input type="radio" name="hist_interest" value="1"><span>1</span></label>
            <label class="radio-pill"><input type="radio" name="hist_interest" value="2"><span>2</span></label>
            <label class="radio-pill"><input type="radio" name="hist_interest" value="3"><span>3</span></label>
            <label class="radio-pill"><input type="radio" name="hist_interest" value="4"><span>4</span></label>
            <label class="radio-pill"><input type="radio" name="hist_interest" value="5"><span>5</span></label>
          </div>
          <div class="likert-scale" id="histInterestScale"><span>そう思わない</span><span>そう思う</span></div>
          <div class="err" id="histInterestErr">1〜5のいずれかを選択してください。</div>
        </div>

        <!-- 歴史資料の保存への関心（必須） -->
        <div class="field" id="f-presInterest">
          <div class="label-row"><label>歴史資料の保存に関心があるか</label><span class="req">*必須</span></div>
          <div class="likert" data-name="preservation_interest" role="radiogroup" aria-describedby="presInterestScale presInterestErr">
            <label class="radio-pill"><input type="radio" name="preservation_interest" value="1"><span>1</span></label>
            <label class="radio-pill"><input type="radio" name="preservation_interest" value="2"><span>2</span></label>
            <label class="radio-pill"><input type="radio" name="preservation_interest" value="3"><span>3</span></label>
            <label class="radio-pill"><input type="radio" name="preservation_interest" value="4"><span>4</span></label>
            <label class="radio-pill"><input type="radio" name="preservation_interest" value="5"><span>5</span></label>
          </div>
          <div class="likert-scale" id="presInterestScale"><span>そう思わない</span><span>そう思う</span></div>
          <div class="err" id="presInterestErr">1〜5のいずれかを選択してください。</div>
        </div>

        <!-- 自主的に調べた経験（必須） -->
        <div class="field" id="f-selfResearch">
          <div class="label-row"><label>興味を持った歴史の事柄について、自主的に調べたことがあるか</label><span class="req">*必須</span></div>
          <div class="likert" data-name="self_research" role="radiogroup" aria-describedby="selfResearchScale selfResearchErr">
            <label class="radio-pill"><input type="radio" name="self_research" value="1"><span>1</span></label>
            <label class="radio-pill"><input type="radio" name="self_research" value="2"><span>2</span></label>
            <label class="radio-pill"><input type="radio" name="self_research" value="3"><span>3</span></label>
            <label class="radio-pill"><input type="radio" name="self_research" value="4"><span>4</span></label>
            <label class="radio-pill"><input type="radio" name="self_research" value="5"><span>5</span></label>
          </div>
          <div class="likert-scale" id="selfResearchScale"><span>そう思わない</span><span>そう思う</span></div>
          <div class="err" id="selfResearchErr">1〜5のいずれかを選択してください。</div>
        </div>

        <!-- アプリで歴史への興味の変化（必須） -->
        <div class="field" id="f-histChange">
          <div class="label-row"><label>本アプリを通して、歴史への興味に変化はあったか</label><span class="req">*必須</span></div>
          <div class="likert" data-name="hist_change" role="radiogroup" aria-describedby="histChangeScale histChangeErr">
            <label class="radio-pill"><input type="radio" name="hist_change" value="1"><span>1</span></label>
            <label class="radio-pill"><input type="radio" name="hist_change" value="2"><span>2</span></label>
            <label class="radio-pill"><input type="radio" name="hist_change" value="3"><span>3</span></label>
            <label class="radio-pill"><input type="radio" name="hist_change" value="4"><span>4</span></label>
            <label class="radio-pill"><input type="radio" name="hist_change" value="5"><span>5</span></label>
          </div>
          <div class="likert-scale" id="histChangeScale"><span>そう思わない</span><span>そう思う</span></div>
          <div class="err" id="histChangeErr">1〜5のいずれかを選択してください。</div>
        </div>

        <!-- アプリで保存への関心の変化（必須） -->
        <div class="field" id="f-presChange">
          <div class="label-row"><label>本アプリを通して、歴史資料の保存の関心に変化はあったか</label><span class="req">*必須</span></div>
          <div class="likert" data-name="preservation_change" role="radiogroup" aria-describedby="presChangeScale presChangeErr">
            <label class="radio-pill"><input type="radio" name="preservation_change" value="1"><span>1</span></label>
            <label class="radio-pill"><input type="radio" name="preservation_change" value="2"><span>2</span></label>
            <label class="radio-pill"><input type="radio" name="preservation_change" value="3"><span>3</span></label>
            <label class="radio-pill"><input type="radio" name="preservation_change" value="4"><span>4</span></label>
            <label class="radio-pill"><input type="radio" name="preservation_change" value="5"><span>5</span></label>
          </div>
          <div class="likert-scale" id="presChangeScale"><span>そう思わない</span><span>そう思う</span></div>
          <div class="err" id="presChangeErr">1〜5のいずれかを選択してください。</div>
        </div>
      </section>

      <!-- ICU在学生・教職員の方へ（任意・統合セクション） -->
      <section class="section" aria-labelledby="forICU">
        <h2 class="sec-title" id="forICU">ICU在学生・教職員の方へ（任意回答）</h2>
        <p class="note">該当しない方・回答を希望しない方は、このセクションは空欄で構いません。</p>

        <!-- パネル展示の認知 -->
        <div class="field">
          <div class="label-row"><label>ICU内の歴史関係の組織・展示について：パネル展示（例：本館173教室前）を知っていたか</label></div>
          <div class="likert" data-name="panel_awareness">
            <label class="radio-pill"><input type="radio" name="panel_awareness" value="1"><span>知らない</span></label>
            <label class="radio-pill"><input type="radio" name="panel_awareness" value="2"><span>見かけたことがある</span></label>
            <label class="radio-pill"><input type="radio" name="panel_awareness" value="3"><span>軽く見たことがある</span></label>
            <label class="radio-pill"><input type="radio" name="panel_awareness" value="4"><span>読んだことがある</span></label>
            <label class="radio-pill"><input type="radio" name="panel_awareness" value="5"><span>じっくり読んだことがある</span></label>
          </div>
        </div>

        <!-- パネル展示への関心 -->
        <div class="field">
          <div class="label-row"><label>本アプリを通して、パネル展示への関心が高まったか</label></div>
          <div class="likert" data-name="panel_interest">
            <label class="radio-pill"><input type="radio" name="panel_interest" value="1"><span>1</span></label>
            <label class="radio-pill"><input type="radio" name="panel_interest" value="2"><span>2</span></label>
            <label class="radio-pill"><input type="radio" name="panel_interest" value="3"><span>3</span></label>
            <label class="radio-pill"><input type="radio" name="panel_interest" value="4"><span>4</span></label>
            <label class="radio-pill"><input type="radio" name="panel_interest" value="5"><span>5</span></label>
          </div>
        </div>

        <!-- アーカイブズの説明 -->
        <p class="note">本アプリの写真や解説は、ICUアーカイブズ（ICUの歴史に関する資料や記録の保存・収集・提供を行う組織。図書館1階に展示室、2階に分室）にご協力いただき提供されています。</p>

        <!-- アーカイブズ認知 -->
        <div class="field">
          <div class="label-row"><label>ICUアーカイブズのことを知っていたか</label></div>
          <div class="likert" data-name="archives_awareness">
            <label class="radio-pill"><input type="radio" name="archives_awareness" value="1"><span>知らない</span></label>
            <label class="radio-pill"><input type="radio" name="archives_awareness" value="2"><span>見かけたことがある</span></label>
            <label class="radio-pill"><input type="radio" name="archives_awareness" value="3"><span>存在を知っている</span></label>
            <label class="radio-pill"><input type="radio" name="archives_awareness" value="4"><span>どういう組織か軽く知っている</span></label>
            <label class="radio-pill"><input type="radio" name="archives_awareness" value="5"><span>どういう組織か詳しく知っている</span></label>
          </div>
        </div>

        <!-- アーカイブズ訪問 -->
        <div class="field">
          <div class="label-row"><label>ICUアーカイブズを訪問したことがあるか</label></div>
          <div class="yn" data-name="archives_visited">
            <!-- 値と表示の整合：yes=はい / no=いいえ に直すなら以下を入れ替えてください -->
            <label class="radio-pill"><input type="radio" name="archives_visited" value="no"><span>いいえ</span></label>
            <label class="radio-pill"><input type="radio" name="archives_visited" value="yes"><span>はい</span></label>
          </div>
        </div>

        <!-- アーカイブズへの関心 -->
        <div class="field">
          <div class="label-row"><label>本アプリにより、ICUアーカイブズへの関心が高まったか</label></div>
          <div class="likert" data-name="archives_interest">
            <label class="radio-pill"><input type="radio" name="archives_interest" value="1"><span>1</span></label>
            <label class="radio-pill"><input type="radio" name="archives_interest" value="2"><span>2</span></label>
            <label class="radio-pill"><input type="radio" name="archives_interest" value="3"><span>3</span></label>
            <label class="radio-pill"><input type="radio" name="archives_interest" value="4"><span>4</span></label>
            <label class="radio-pill"><input type="radio" name="archives_interest" value="5"><span>5</span></label>
          </div>
        </div>
      </section>

      <!-- アプリについて（必須2問） -->
      <section class="section" aria-labelledby="aboutApp">
        <h2 class="sec-title" id="aboutApp">アプリについて</h2>

        <div class="field" id="f-fun">
          <div class="label-row"><label>面白かったか</label><span class="req">*必須</span></div>
          <div class="likert" data-name="fun" role="radiogroup" aria-describedby="funScale funErr">
            <label class="radio-pill"><input type="radio" name="fun" value="1"><span>1</span></label>
            <label class="radio-pill"><input type="radio" name="fun" value="2"><span>2</span></label>
            <label class="radio-pill"><input type="radio" name="fun" value="3"><span>3</span></label>
            <label class="radio-pill"><input type="radio" name="fun" value="4"><span>4</span></label>
            <label class="radio-pill"><input type="radio" name="fun" value="5"><span>5</span></label>
          </div>
          <div class="likert-scale" id="funScale"><span>そう思わない</span><span>そう思う</span></div>
          <div class="err" id="funErr">1〜5のいずれかを選択してください。</div>
        </div>

        <div class="field" id="f-usability">
          <div class="label-row"><label>使いやすかったか</label><span class="req">*必須</span></div>
          <div class="likert" data-name="usability" role="radiogroup" aria-describedby="usabilityScale usabilityErr">
            <label class="radio-pill"><input type="radio" name="usability" value="1"><span>1</span></label>
            <label class="radio-pill"><input type="radio" name="usability" value="2"><span>2</span></label>
            <label class="radio-pill"><input type="radio" name="usability" value="3"><span>3</span></label>
            <label class="radio-pill"><input type="radio" name="usability" value="4"><span>4</span></label>
            <label class="radio-pill"><input type="radio" name="usability" value="5"><span>5</span></label>
          </div>
          <div class="likert-scale" id="usabilityScale"><span>そう思わない</span><span>そう思う</span></div>
          <div class="err" id="usabilityErr">1〜5のいずれかを選択してください。</div>
        </div>
      </section>

      <!-- 自由記述（任意） -->
      <section class="section" aria-labelledby="free">
        <h2 class="sec-title" id="free">自由記述欄（任意）</h2>
        <div class="field">
          <div class="label-row"><label for="free_text">ご意見・ご感想など</label></div>
          <textarea id="free_text" name="free_text" class="textarea" placeholder="ご自由にお書きください（任意）"></textarea>
        </div>
      </section>

      <div class="footer">
        <button id="submitSurveyBtn" type="button" class="btn" aria-busy="false">アンケート送信</button>
      </div>
    </form>
  </div>
  <!-- 既存本文ここまで -->

  <script>
    // 言語メニュー（共通）
    (function initLangMenu(){
      const btn  = document.getElementById('langBtn');
      const menu = document.getElementById('langMenu');
      const items= menu?.querySelectorAll('.lang-item');
      const open = (v)=>{
        if (!menu || !btn) return;
        menu.classList.toggle('is-open', v);
        btn.setAttribute('aria-expanded', v ? 'true':'false');
      };
      btn?.addEventListener('click', (e)=>{
        e.stopPropagation();
        open(!menu.classList.contains('is-open'));
      });
      document.addEventListener('click', ()=> open(false));
      items?.forEach(it=>{
        it.addEventListener('click', ()=>{
          const lang = it.dataset.lang || 'ja';
          try { localStorage.setItem('app_lang', lang); } catch(e){}
          if (typeof window.applyLang === 'function') { window.applyLang(lang); }
          else { location.reload(); }
        });
      });
    })();
  </script>

  <script src="js/firebase.js" defer></script>
  <script src="js/post-survey.js" defer></script>
</body>
</html>
