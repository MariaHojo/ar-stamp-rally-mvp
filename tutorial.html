<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style>
    :root{ --accent:#005ABB; --text:#111; --muted:#444; --bg:#fff; --card:#ffffff; --shadow:0 12px 32px rgba(0,0,0,.08); --radius:16px; }
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;line-height:1.6}
    .wrap{max-width:960px;margin:0 auto;padding:clamp(10px,3vw,16px);min-height:100vh;display:flex;flex-direction:column;position:relative}
    header{padding:4px 0 8px; position:relative}
    h1{font-size:20px;margin:0;font-weight:900}
    [data-lang-anchor]{position:absolute;right:8px;top:8px}

    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:clamp(12px,3vw,18px);display:flex;flex-direction:column;gap:12px;min-height:60vh}
    .hero{width:100%;aspect-ratio:4/3;border-radius:12px;overflow:hidden;background:#f3f6fc;border:1px solid #e9eef6;display:flex;align-items:center;justify-content:center}
    .hero img{width:100%;height:100%;object-fit:cover;display:block}
    .panel{margin-top:auto;background:#f7f9fe;border:1px solid #e3eaf6;border-radius:12px;padding:12px}
    .panel p{margin:.4em 0}
    .pageDots{margin-top:6px;text-align:center;font-size:0}
    .dot{display:inline-block;width:9px;height:9px;margin:0 3px;border-radius:999px;background:#c9d6ee}
    .dot.active{background:var(--accent)}

    .termsBox{height:min(40vh, 320px);overflow:auto;background:#fff;border:1px solid #dfe7f7;border-radius:12px;padding:12px;line-height:1.55;font-size:14px;color:#222}
    .agreeLine{display:flex;align-items:center;gap:10px;margin-top:10px}
    .agreeLine small{color:#333}

    .ctaRow{display:flex;gap:10px;flex-wrap:wrap;justify-content:space-between;margin-top:10px}
    .btn{appearance:none;border:0;border-radius:12px;padding:14px 16px;font-weight:900;cursor:pointer;background:var(--accent);color:#fff;box-shadow:0 10px 28px rgba(0,90,187,.25);flex:1;min-width:160px;text-align:center}
    .btn[disabled]{opacity:.45;box-shadow:none;cursor:not-allowed}
    .btn-secondary{background:#e9eef6;color:#111;box-shadow:none}
    .btn-ghost{background:transparent;color:var(--accent);box-shadow:none}
    .footerSpace{height:max(8px, env(safe-area-inset-bottom))}
    @media (max-width:560px){ .btn{min-width:0} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1 id="ttl">ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</h1>
      <div data-lang-anchor></div>
    </header>

    <main class="card" id="slideRoot" aria-live="polite">
      <div class="hero" aria-hidden="true">
        <img id="slideImg" src="assets/images/tutorial_image01.png" alt="ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ç”»åƒ">
      </div>

      <section class="panel">
        <div id="slideText" style="min-height:4lh"></div>

        <!-- 1ãƒšãƒ¼ã‚¸ç›®ï¼šè¦ç´„ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‹åŒæ„ -->
        <div id="termsArea" style="display:none; margin-top:10px;">
          <div class="termsBox" id="termsBox" tabindex="0" aria-label="åˆ©ç”¨è¦ç´„æœ¬æ–‡ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯ï¼‰">
            <!-- æ–‡é¢ã¯ i18n ã§å·®ã—æ›¿ãˆ -->
            <h3 id="termsHdr" style="margin:.2em 0 0;font-size:16px">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ãƒ»ã”åˆ©ç”¨ä¸Šã®æ³¨æ„</h3>
            <div id="termsBody">
              <!-- i18n ã§æ³¨å…¥ -->
            </div>
          </div>
          <label class="agreeLine">
            <input id="agreeChk" type="checkbox" />
            <small id="agreeLbl">åˆ©ç”¨è¦ç´„ã‚’èª­ã¿ã€åŒæ„ã—ã¾ã™ã€‚</small>
          </label>
        </div>

        <div class="pageDots" aria-hidden="true" id="dots"></div>

        <div class="ctaRow">
          <button id="prevBtn" class="btn btn-secondary" type="button">æˆ»ã‚‹</button>
          <button id="nextBtn" class="btn" type="button">æ¬¡ã¸</button>
        </div>
        <div class="ctaRow" style="margin-top:2px">
          <button id="skipBtn" class="btn-ghost" type="button">skip</button>
        </div>
      </section>
    </main>

    <div class="footerSpace"></div>
  </div>

  <script>
    if (!window.withV) {
      window.BUILD_V = window.BUILD_V || '20251009';
      window.withV = (url) => url + (url.includes('?') ? '&' : '?') + 'v=' + window.BUILD_V;
    }
  </script>
  <script src="js/lang.js"></script>
  <script>
    /* ====== i18n å®šç¾© ====== */
    const I18N = {
      ja: {
        pageTitle: 'ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«',
        slides: [
          'ARã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼ã¸ã‚ˆã†ã“ãï¼æœ¬ã‚¢ãƒ—ãƒªã¯ğ“¸ğ“¸ã«ã‚ˆã‚‹å’æ¥­ç ”ç©¶ã®ãŸã‚ã«é–‹ç™ºã•ã‚ŒãŸã‚‚ã®ã§ã™ã€‚ä»¥ä¸‹ã®æ³¨æ„äº‹é …ã‚’èª­ã¿ã€åŒæ„ã—ã¦ãã ã•ã‚‹æ–¹ã¯ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚',
          'ã‚¹ã‚¿ãƒ³ãƒ—å°ã«è²¼ã£ã¦ã‚ã‚‹ã‚¿ã‚°ã‚’èª­ã‚“ã§ãã ã•ã„ã€‚',
          'ã€Œã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ã€ã‚’æŠ¼ã—ã€ä»Šã„ã‚‹å ´æ‰€ã‚’é¸æŠã—ã¾ã™ã€‚',
          'ã‚«ãƒ¡ãƒ©ã¨ä½ç½®æƒ…å ±ã®è¨±å¯ã‚’ã—ã¦ãã ã•ã„ã€‚',
          'ARã‚’è¦‹ã¦ã€æ¥½ã—ã¿ã¾ã—ã‚‡ã†ï¼',
          'ã“ã“ã‹ã‚‰ã‚¹ã‚¿ãƒ³ãƒ—ãŒè²°ãˆã¾ã™ï¼',
          'ã‚¯ã‚¤ã‚º&è§£èª¬ãƒšãƒ¼ã‚¸ã¸è¡Œãã€ã‚¯ã‚¤ã‚ºã«æŒ‘æˆ¦ã—ã¾ã—ã‚‡ã†ã€‚',
          '6ã¤é›†ã‚ãŸã‚‰ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆï¼ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã«ãŠç­”ãˆã„ãŸã ãã¨ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¦‹ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚æœ€å¾Œã«ã€Œã¯ã˜ã‚ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚'
        ],
        termsHdr: 'ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ãƒ»ã”åˆ©ç”¨ä¸Šã®æ³¨æ„',
        termsHtml: `
          <p>æœ¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯å¤§å­¦ã®å’æ¥­ç ”ç©¶ã®ä¸€ç’°ã¨ã—ã¦å®Ÿæ–½ã•ã‚Œã¦ã„ã¾ã™ã€‚ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆç­‰ã§ã”è¨˜å…¥ã„ãŸã ã„ãŸæƒ…å ±ã¯ã€ç ”ç©¶ç›®çš„ã®ã¿ã«ä½¿ç”¨ã—ã€ç ”ç©¶ç›®çš„ä»¥å¤–ã«ã¯ä¸€åˆ‡åˆ©ç”¨ã„ãŸã—ã¾ã›ã‚“ã€‚</p>
          <p>åé›†ã—ãŸãƒ‡ãƒ¼ã‚¿ã¯åŒ¿ååŒ–ã—ã€çµ±è¨ˆçš„ã«å‡¦ç†ãƒ»åˆ†æã—ã¾ã™ã€‚çµæœã‚’å…¬è¡¨ã™ã‚‹éš›ã«ã‚‚å€‹äººãŒè­˜åˆ¥ã•ã‚Œã‚‹æƒ…å ±ã¯å«ã¿ã¾ã›ã‚“ã€‚ç¬¬ä¸‰è€…ã¸ã®æä¾›ã‚‚ã€åˆ©ç”¨è€…ã®åŒæ„ãªãè¡Œã„ã¾ã›ã‚“ã€‚</p>
          <p>æœ¬ã‚¢ãƒ—ãƒªã¯ARä½“é¨“ã‚’å«ã¿ã€æ­©è¡Œã‚„å±‹å¤–ã§ã®åˆ©ç”¨ã‚’ä¼´ã†å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ã”åˆ©ç”¨ã®éš›ã¯å‘¨å›²ã®å®‰å…¨ã«ååˆ†ã”æ³¨æ„ãã ã•ã„ã€‚ARåˆ©ç”¨ä¸­ã®äº‹æ•…ãƒ»ã‚±ã‚¬ãƒ»æ©Ÿå™¨ã®ç ´æã«ã¤ã„ã¦ã€é‹å–¶ã¯è²¬ä»»ã‚’è² ã„ã‹ã­ã¾ã™ã€‚</p>
          <p>æœ¬ã‚¢ãƒ—ãƒªã¯ç„¡æ–™ã§ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ãŒã€é€šä¿¡è²»ã¯åˆ©ç”¨è€…ã®ã”è² æ‹…ã¨ãªã‚Šã¾ã™ã€‚</p>
        `,
        agreeLbl: 'åˆ©ç”¨è¦ç´„ã‚’èª­ã¿ã€åŒæ„ã—ã¾ã™ã€‚',
        btnPrev: 'æˆ»ã‚‹', btnNext: 'æ¬¡ã¸', btnStart: 'ã¯ã˜ã‚ã‚‹', btnSkip: 'skip'
      },
      en: {
        pageTitle: 'Tutorial',
        slides: [
          'Welcome to the AR Stamp Rally! This app was developed as part of a graduation project. Please read the notes below and check the box if you agree.',
          'Scan the tag attached to the stamp stand.',
          'Tap â€œOpen Cameraâ€ and select your current spot.',
          'Please allow camera and location permissions.',
          'Enjoy the AR experience!',
          'You can get stamps from here!',
          'Go to the Quiz & Explanation page and try the quiz.',
          'Collect all six to complete! If you answer the survey, you can view special contents. Finally, tap â€œStartâ€.'
        ],
        termsHdr: 'Privacy Policy & Safety Notes',
        termsHtml: `
          <p>This application is conducted as part of a university graduation project. Information you provide (e.g., in surveys) will only be used for research purposes and never for any other purpose.</p>
          <p>Collected data will be anonymized and analyzed statistically. Publications will not contain personally identifiable information. We will not provide personal data to third parties without your consent.</p>
          <p>This app includes AR experiences and may involve walking or outdoor use. Please be mindful of your surroundings. We cannot accept responsibility for accidents, injuries, or device damage during AR use.</p>
          <p>The app is free to use; however, communication fees (e.g., mobile data) are borne by the user.</p>
        `,
        agreeLbl: 'I have read and agree to the terms.',
        btnPrev: 'Back', btnNext: 'Next', btnStart: 'Start', btnSkip: 'skip'
      }
    };

    /* ====== ã‚¹ãƒ©ã‚¤ãƒ‰å®šç¾© ====== */
    const slides = [
      { img: 'assets/images/tutorial_image01.png', showTerms: true },
      { img: 'assets/images/tutorial_image02.png' },
      { img: 'assets/images/tutorial_image03.png' },
      { img: 'assets/images/tutorial_image04.png' },
      { img: 'assets/images/tutorial_image05.png' },
      { img: 'assets/images/tutorial_image06.png' },
      { img: 'assets/images/tutorial_image07.png' },
      { img: 'assets/images/tutorial_image08.png' },
    ];

    // è¦ç´ å–å¾—
    const imgEl   = document.getElementById('slideImg');
    const textEl  = document.getElementById('slideText');
    const termsEl = document.getElementById('termsArea');
    const agreeEl = document.getElementById('agreeChk');
    const agreeLbl= document.getElementById('agreeLbl');
    const dotsEl  = document.getElementById('dots');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const skipBtn = document.getElementById('skipBtn');

    let idx = 0;

    function renderDots(){
      dotsEl.innerHTML = '';
      for (let i=0;i<slides.length;i++){
        const d = document.createElement('span');
        d.className = 'dot' + (i===idx ? ' active' : '');
        dotsEl.appendChild(d);
      }
    }

    window.applyI18n = function(){
      const lang = window.getLang();
      const t = I18N[lang];
      document.documentElement.setAttribute('lang', lang);
      document.title = t.pageTitle;
      document.getElementById('ttl').textContent = t.pageTitle;
      document.getElementById('termsHdr').textContent = t.termsHdr;
      document.getElementById('termsBody').innerHTML = t.termsHtml;
      agreeLbl.textContent = t.agreeLbl;
      prevBtn.textContent = t.btnPrev;
      nextBtn.textContent = (idx === slides.length - 1) ? t.btnStart : t.btnNext;
      skipBtn.textContent = t.btnSkip;
      // ã‚¹ãƒ©ã‚¤ãƒ‰æœ¬æ–‡
      textEl.innerHTML = t.slides[idx];
    };

    function render(){
      const lang = window.getLang();
      const t = I18N[lang];
      const s = slides[idx];
      imgEl.src = s.img;
      textEl.innerHTML = t.slides[idx];

      if (s.showTerms){ termsEl.style.display = 'block'; }
      else { termsEl.style.display = 'none'; }

      document.getElementById('nextBtn').textContent = (idx === slides.length - 1) ? t.btnStart : t.btnNext;
      prevBtn.style.visibility = (idx === 0 ? 'hidden' : 'visible');
      nextBtn.disabled = (idx === 0 && !agreeEl.checked);
      renderDots();
    }

    function goNext(){
      if (idx === 3){ // æ¨©é™ï¼ˆä»»æ„ï¼‰
        try{
          navigator.mediaDevices?.getUserMedia?.({video:true}).then(s=>s.getTracks().forEach(t=>t.stop()));
          navigator.geolocation?.getCurrentPosition?.(()=>{},()=>{}, {enableHighAccuracy:true, timeout:2000});
        }catch(e){}
      }
      const lang = window.getLang();
      const t = I18N[lang];
      if (idx < slides.length - 1){ idx++; render(); window.applyI18n(); }
      else {
        try { localStorage.setItem('tutorial_done','1'); } catch {}
        location.href = withV('map.html');
      }
    }
    function goPrev(){ if (idx > 0){ idx--; render(); window.applyI18n(); } }
    function skipAll(){ try { localStorage.setItem('tutorial_done','1'); } catch {} location.href = withV('map.html'); }

    agreeEl.addEventListener('change', ()=>{ if (idx === 0){ nextBtn.disabled = !agreeEl.checked; }});
    prevBtn.addEventListener('click', goPrev);
    nextBtn.addEventListener('click', goNext);
    skipBtn.addEventListener('click', skipAll);

    document.addEventListener('DOMContentLoaded', ()=>{
      window.injectLangUI();
      window.applyI18n();
      render();
    });
  </script>
</body>
</html>
